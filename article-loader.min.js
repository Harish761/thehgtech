let articlesData = {}; async function loadArticlesFromJSON() { try { console.log('[article-loader] Starting to load articles.json...'); const cacheBuster = Date.now(); const response = await fetch(`articles.json?v=${cacheBuster}`, { cache: 'no-store' }); const data = await response.json(); console.log('[article-loader] Loaded articles.json:', data.articles.length, 'articles'); articlesData = {}; data.articles.forEach(article => { articlesData[article.id] = article; }); if (websiteContent && websiteContent.articleCards) { console.log('[article-loader] contentData.articleCards found:', websiteContent.articleCards.length, 'articles'); const jsonArticles = data.articles.map(article => ({ id: article.id, date: article.date, category: article.category, title: article.title.length > 50 ? article.title.substring(0, 47) + '...' : article.title, excerpt: article.excerpt })); websiteContent.articleCards = [...jsonArticles, ...websiteContent.articleCards]; console.log('[article-loader] Merged articles. Total now:', websiteContent.articleCards.length); renderArticleCards(); console.log('[article-loader] Articles rendered to DOM'); } else { console.error('[article-loader] ERROR: websiteContent or articleCards not found!'); } console.log('[article-loader] Articles loaded successfully from JSON'); return articlesData; } catch (error) { console.error('[article-loader] Error loading articles:', error); return null; } } function renderArticleCards() { const container = document.querySelector('#articlesGrid'); if (!container || !websiteContent || !websiteContent.articleCards) return; container.innerHTML = websiteContent.articleCards.map(article => { const fullArticle = articlesData[article.id]; const imageHTML = fullArticle && fullArticle.image ? `<div class="article-image" style="background-image: url('${fullArticle.image}');"></div>` : ''; return ` <div class="article-card" onclick="openArticleModal('${article.id}')"> ${imageHTML} <div class="article-content"> <div class="article-category">${article.category}</div> <h3>${article.title}</h3> <p>${article.excerpt}</p> <div class="article-meta"> <span>${article.date}</span> <span class="read-more">Read Full Article â†’</span> </div> </div> </div> `; }).join(''); } if (typeof window !== 'undefined') { console.log('[article-loader] Script loaded'); function waitForContentData() { if (websiteContent && websiteContent.articleCards) { console.log('[article-loader] contentData found! Loading articles...'); loadArticlesFromJSON(); } else { console.log('[article-loader] Waiting for contentData... (checking again in 100ms)'); setTimeout(waitForContentData, 100); } } if (document.readyState === 'loading') { console.log('[article-loader] DOM still loading, waiting...'); document.addEventListener('DOMContentLoaded', waitForContentData); } else { console.log('[article-loader] DOM ready, starting wait for contentData'); waitForContentData(); } }