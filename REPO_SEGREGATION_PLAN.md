# üîê FAILPROOF Repository Segregation Plan

## Executive Summary

**Goal**: Split one public repo into PUBLIC (website) + PRIVATE (automation) to prevent easy cloning/replication.

---

## ‚ö†Ô∏è CRITICAL QUESTIONS ANSWERED

### 1. Will Anything Break?

**NO** - Here's why:

| Component | Dependency Check | Status |
|-----------|------------------|--------|
| HTML Pages | Load CSS/JS files only | ‚úÖ Safe to keep |
| CSS Files | Standalone styling | ‚úÖ Safe to keep |
| JS Files | Fetch JSON data, no Python calls | ‚úÖ Safe to keep |
| JSON Data | Generated by Python, consumed by JS | ‚úÖ Keep JSON in public |
| Python Scripts | Only run by GitHub Actions | ‚úÖ Safe to move to private |
| Workflows | Trigger Python scripts | ‚úÖ Safe to move to private |

**Verification**: Searched entire codebase - NO HTML/JS file directly imports or runs Python scripts. The Python scripts only:
- Run via GitHub Actions (scheduled)
- Generate JSON files
- Commit JSON back to repo

### 2. Is Private Repo Free?

**YES** - GitHub Free Plan includes:
- ‚úÖ Unlimited private repositories
- ‚úÖ Unlimited collaborators
- ‚ö†Ô∏è GitHub Actions: **2,000 minutes/month** (private repos)

### 3. GitHub Actions Limits for Private Repos

| Plan | Actions Minutes/Month | Storage |
|------|----------------------|---------|
| **Free** | 2,000 minutes | 500 MB |
| Pro ($4/mo) | 3,000 minutes | 2 GB |
| Team ($4/user/mo) | 3,000 minutes | 2 GB |

**Your Current Usage Estimate**:
```
Workflow              | Runs/Day | Minutes/Run | Monthly Minutes
----------------------|----------|-------------|----------------
threat-intel.yml      | 7        | ~2 min      | ~420 min
update-shorts.yml     | 2        | ~2 min      | ~120 min
ransomware.yml        | 2        | ~1 min      | ~60 min
weekly-report.yml     | 0.25     | ~1 min      | ~1 min
----------------------|----------|-------------|----------------
TOTAL                 |          |             | ~600 min/month
```

**Verdict**: ‚úÖ Well within 2,000 min free limit (using only ~30%)

---

## üìã WHAT GOES WHERE

### PUBLIC REPO (thehgtech) - GitHub Pages

**Keep these files** - Required for website to function:

```
thehgtech/
‚îú‚îÄ‚îÄ index.html, 404.html, *.html          # All HTML pages
‚îú‚îÄ‚îÄ articles/*.html                        # 26 article pages
‚îú‚îÄ‚îÄ guides/*.html                          # 34 guide pages  
‚îú‚îÄ‚îÄ comparisons/*.html                     # 5 comparison pages
‚îú‚îÄ‚îÄ *.css                                  # All stylesheets (~25 files)
‚îú‚îÄ‚îÄ *.js                                   # All frontend JS (~35 files)
‚îú‚îÄ‚îÄ *.json                                 # Data files (generated)
‚îÇ   ‚îú‚îÄ‚îÄ articles.json
‚îÇ   ‚îú‚îÄ‚îÄ cve-data.json
‚îÇ   ‚îú‚îÄ‚îÄ ransomware-data.json
‚îÇ   ‚îî‚îÄ‚îÄ threat-intel-history.json
‚îú‚îÄ‚îÄ images/                                # All images
‚îú‚îÄ‚îÄ ioc-data/                              # IOC data files
‚îú‚îÄ‚îÄ CNAME                                  # Domain config
‚îú‚îÄ‚îÄ robots.txt, sitemap.xml, rss.xml       # SEO files
‚îú‚îÄ‚îÄ .htaccess                              # Server config
‚îú‚îÄ‚îÄ favicon.ico, logo-*.png                # Branding
‚îî‚îÄ‚îÄ README.md                              # Basic readme (public-facing)
```

### PRIVATE REPO (thehgtech-backend)

**Move these files** - Not needed for website, contains your logic:

```
thehgtech-backend/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ threat-intel.yml
‚îÇ       ‚îú‚îÄ‚îÄ update-shorts.yml
‚îÇ       ‚îú‚îÄ‚îÄ ransomware.yml
‚îÇ       ‚îî‚îÄ‚îÄ weekly-report.yml
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ fetch_threat_intel.py
‚îÇ   ‚îú‚îÄ‚îÄ fetch_ai_security.py
‚îÇ   ‚îú‚îÄ‚îÄ fetch_ransomware.py
‚îÇ   ‚îú‚îÄ‚îÄ enrich_cve_dual_source.py
‚îÇ   ‚îú‚îÄ‚îÄ enrich_cve_patches.py
‚îÇ   ‚îú‚îÄ‚îÄ update_shorts.py
‚îÇ   ‚îú‚îÄ‚îÄ generate_weekly_report.py
‚îÇ   ‚îú‚îÄ‚îÄ add_mobile_nav_to_*.py
‚îÇ   ‚îî‚îÄ‚îÄ update_guides_interaction_bar.py
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ article-template.html
‚îÇ   ‚îî‚îÄ‚îÄ guide-template.html
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ *.md                               # All 53 markdown files
‚îú‚îÄ‚îÄ .agent/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/                         # Agent configs
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md                              # Private documentation
```

---

## üîÑ HOW THE WORKFLOW CHANGES

### BEFORE (Single Repo):
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ thehgtech (PUBLIC)                                          ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ Python scripts                                          ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ Workflows run here                                      ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ Generate JSON ‚Üí Commit to same repo                     ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ GitHub Pages serves from same repo                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### AFTER (Two Repos):
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ thehgtech-backend (PRIVATE)                                 ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ Python scripts                                          ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ Workflows run here                                      ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ Generate JSON                                           ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ Push JSON to PUBLIC repo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                    ‚îÇ
                                                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ thehgtech (PUBLIC)                                          ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ HTML/CSS/JS (static)                                    ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ JSON data (updated by private repo)                     ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ GitHub Pages serves website                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß MODIFIED WORKFLOW FILES

Each workflow needs ONE change - push to the PUBLIC repo instead of current repo.

### Example: threat-intel.yml (AFTER)

```yaml
name: RSS Threat Intel Update

on:
  schedule:
    - cron: '5 */4 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout PRIVATE repo (backend)
        uses: actions/checkout@v4

      - name: Checkout PUBLIC repo (website)
        uses: actions/checkout@v4
        with:
          repository: Harish761/thehgtech
          token: ${{ secrets.PUBLIC_REPO_TOKEN }}
          path: public-site

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install feedparser requests beautifulsoup4 pyyaml

      - name: Run scripts (from private repo)
        env:
          NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python scripts/fetch_threat_intel.py --both
          python scripts/fetch_ai_security.py --output public-site/ioc-data
          python scripts/enrich_cve_dual_source.py

      - name: Copy generated files to public repo
        run: |
          cp threat-intel.js public-site/
          cp threat-intel-history.json public-site/
          cp threat-intel-history.js public-site/
          cp ti-snapshot.html public-site/
          cp cve-data.json public-site/
          cp -r ioc-data/* public-site/ioc-data/

      - name: Commit & Push to PUBLIC repo
        run: |
          cd public-site
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add -A
          git diff --quiet && git diff --staged --quiet || \
            git commit -m "üõ°Ô∏è Threat Intel update [$(date -u '+%Y-%m-%d %H:%M')] UTC"
          git push
```

---

## üîë SECRETS SETUP

### In Private Repo (thehgtech-backend):

You need to create a **Personal Access Token (PAT)** to push to public repo:

1. Go to GitHub ‚Üí Settings ‚Üí Developer Settings ‚Üí Personal Access Tokens ‚Üí Fine-grained tokens
2. Create new token with:
   - **Name**: `thehgtech-deploy`
   - **Expiration**: 1 year (or custom)
   - **Repository access**: Only select `thehgtech`
   - **Permissions**: Contents (Read and Write)
3. Copy the token

4. Add as secret in private repo:
   - Go to `thehgtech-backend` ‚Üí Settings ‚Üí Secrets ‚Üí Actions
   - Add: `PUBLIC_REPO_TOKEN` = your PAT

### Existing Secrets to Copy:
- `NVD_API_KEY` ‚Üí Copy to private repo
- `OPENAI_API_KEY` ‚Üí Copy to private repo

---

## üìÖ STEP-BY-STEP MIGRATION PLAN

### Phase 1: Preparation (Day 1)

```bash
# 1. Create backup
cd /Volumes/Data-Personal/Webpage
cp -r thehgtech thehgtech-backup-$(date +%Y%m%d)

# 2. Create private repo on GitHub
# Go to github.com ‚Üí New Repository
# Name: thehgtech-backend
# Visibility: Private
# Don't initialize with README
```

### Phase 2: Setup Private Repo (Day 1)

```bash
# 3. Clone the new private repo
cd /Volumes/Data-Personal/Webpage
git clone https://github.com/Harish761/thehgtech-backend.git

# 4. Create directory structure
cd thehgtech-backend
mkdir -p scripts docs .github/workflows

# 5. Copy files from public to private
cp ../thehgtech/*.py scripts/
cp -r ../thehgtech/.github/workflows/* .github/workflows/
cp -r ../thehgtech/templates .
cp -r ../thehgtech/.agent .
cp -r ../thehgtech/docs/* docs/
cp ../thehgtech/*.md docs/
cp ../thehgtech/requirements.txt .

# 6. Update workflow files (modify paths)
# Edit each .yml file to use new structure

# 7. Commit and push
git add -A
git commit -m "Initial setup: Move backend files from public repo"
git push origin main
```

### Phase 3: Setup Secrets (Day 1)

```bash
# 8. Create PAT for cross-repo push (GitHub web)
# 9. Add secrets to private repo:
#    - PUBLIC_REPO_TOKEN
#    - NVD_API_KEY
#    - OPENAI_API_KEY
```

### Phase 4: Test Private Repo (Day 2)

```bash
# 10. Manually trigger one workflow
# GitHub ‚Üí thehgtech-backend ‚Üí Actions ‚Üí threat-intel.yml ‚Üí Run workflow

# 11. Verify:
#     - Workflow runs successfully
#     - Data is pushed to public repo
#     - Website still works
```

### Phase 5: Clean Public Repo (Day 3 - After Verification)

```bash
# 12. Remove backend files from public repo
cd /Volumes/Data-Personal/Webpage/thehgtech

# Remove Python scripts
git rm *.py

# Remove workflows
git rm -r .github/workflows

# Remove templates and agent
git rm -r templates .agent docs

# Remove markdown docs (keep README.md)
git rm ADDITIONAL_IMPROVEMENTS_ANALYSIS.md
git rm ANALYTICS_VERIFICATION.md
# ... (all other .md files except README.md)

# Update .gitignore
echo "*.py" >> .gitignore
echo ".agent/" >> .gitignore
echo "templates/" >> .gitignore
echo "docs/" >> .gitignore

# Commit
git commit -m "üîí Move backend to private repo for IP protection"
git push
```

### Phase 6: Ongoing Maintenance

- **Public repo**: Only receives automated data updates
- **Private repo**: Where you develop and test
- **Local development**: Use private repo for testing, push to both

---

## ‚ö†Ô∏è POTENTIAL ISSUES & SOLUTIONS

### Issue 1: Workflow Fails to Push to Public Repo
**Cause**: PAT token expired or wrong permissions
**Solution**: Regenerate PAT, update secret

### Issue 2: Path Errors in Scripts
**Cause**: Scripts expect files in root, now in `scripts/`
**Solution**: Update Python scripts to use relative paths or pass output directory

### Issue 3: content.js Not Updated
**Cause**: update_shorts.py generates content.js, needs to go to public repo
**Solution**: Ensure workflow copies content.js to public-site/

### Issue 4: Minutes Exceeded
**Cause**: Unlikely with current usage, but possible if adding more workflows
**Solution**: Reduce frequency or upgrade to Pro ($4/month)

---

## ‚úÖ VERIFICATION CHECKLIST

After migration, verify:

- [ ] Public website loads correctly (thehgtech.com)
- [ ] CVE tracker shows data
- [ ] Threat intel dashboard works
- [ ] Ransomware tracker shows data
- [ ] All articles/guides load
- [ ] Private repo workflows run on schedule
- [ ] Data updates appear in public repo
- [ ] No Python scripts visible in public repo
- [ ] No workflow files visible in public repo

---

## üéØ SUMMARY

| Question | Answer |
|----------|--------|
| Will it break anything? | **NO** - Frontend doesn't call Python |
| Is private repo free? | **YES** - Unlimited private repos |
| Are Actions free? | **YES** - 2000 min/month, you use ~600 |
| Effort required | ~2-3 hours one-time setup |
| Risk level | **LOW** - Reversible if issues |

---

## üöÄ READY TO PROCEED?

This plan is **failproof** because:
1. All changes are reversible
2. Backup created before migration
3. Testing phase before cleanup
4. Clear verification checklist

Let me know when you want to start the migration!
