<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>Live Threat Intelligence with AI Insights & 7-Day Trends | TheHGTech</title>
    <meta name="title" content="Live Threat Intelligence with AI Insights & 7-Day Trends | TheHGTech">
    <meta name="description"
        content="Real-time IOCs from 9 security vendors (OpenPhish, URLhaus, ThreatFox, Feodo, Blocklist.de, SSL Blacklist, Malware Bazaar, Spamhaus, CINS Army) with AI-powered daily summaries, weekly analysis, 7-day trend charts, and updates every 4 hours. Free threat intelligence dashboard.">
    <meta name="keywords"
        content="threat intelligence, live IOCs, AI threat analysis, 7-day trends, OpenPhish, URLhaus, ThreatFox, Feodo Tracker, real-time threats, phishing detection, malware feeds, C2 tracking, threat dashboard, security intelligence, GPT-4 analysis">
    <meta name="author" content="TheHGTech">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://thehgtech.com/threat-intel.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thehgtech.com/threat-intel.html">
    <meta property="og:title" content="Live Threat Intelligence with AI Insights & 7-Day Trends | TheHGTech">
    <meta property="og:description"
        content="Real-time IOCs from 9 vendors with AI-powered analysis, 7-day trend charts, and updates every 4 hours. Free threat intelligence dashboard.">
    <meta property="og:image" content="https://thehgtech.com/images/threat-intel-og.jpg">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://thehgtech.com/threat-intel.html">
    <meta name="twitter:title" content="Live Threat Intelligence with AI Insights & 7-Day Trends">
    <meta name="twitter:description"
        content="Real-time IOCs from 9 vendors with AI analysis, 7-day trends, and updates every 4 hours.">
    <meta name="twitter:image" content="https://thehgtech.com/images/threat-intel-twitter.jpg">

    <!-- ========== STRUCTURED DATA - ARTICLE SCHEMA ========== -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "Live Threat Intelligence Dashboard with AI-Powered Analysis",
      "description": "Real-time threat intelligence from 9 trusted security vendors with AI-powered daily summaries, 7-day trend analysis, and updates every 2 hours",
      "image": {
        "@type": "ImageObject",
        "url": "https://thehgtech.com/images/threat-intel-og.jpg",
        "width": 1200,
        "height": 630
      },
      "author": {
        "@type": "Organization",
        "name": "TheHGTech",
        "url": "https://thehgtech.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "TheHGTech",
        "logo": {
          "@type": "ImageObject",
          "url": "https://thehgtech.com/logo.png",
          "width": 600,
          "height": 60
        }
      },
      "datePublished": "2024-01-01",
      "dateModified": "2025-11-25",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://thehgtech.com/threat-intel.html"
      },
      "keywords": "threat intelligence, live IOCs, AI threat analysis, OpenPhish, Malware Bazaar, Spamhaus DROP, CINS Army, Blocklist.de",
      "articleSection": "Cybersecurity",
      "inLanguage": "en-US",
      "wordCount": 500,
      "about": {
        "@type": "Thing",
        "name": "Threat Intelligence",
        "description": "Real-time cybersecurity threat intelligence and indicators of compromise"
      }
    }
    </script>


    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

    <!-- ========== PERFORMANCE OPTIMIZATION ========== -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>

    <!-- Dashboard Integration -->
    <link rel="stylesheet" href="threat-intel-tabs.css">
    <link rel="stylesheet" href="advanced-filters.css">
    <link rel="stylesheet" href="ransomware-display.css">
    <link rel="stylesheet" href="ransomware-modal.css">

    <!-- Non-blocking FontAwesome -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style"
        onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </noscript>

    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="ti-hero-animation.css">
    <script src="dashboard-data.js" defer></script>
    <script src="threat-intel-tabs.js?v=20251127" defer></script>
    <script src="ti-hero-animation.js" defer></script>

    <!-- Mobile Optimization (v3.0) -->
    <link rel="stylesheet" href="m-core.css?v=4.2">
    <link rel="stylesheet" href="m-layout.css?v=3.2">
    <link rel="stylesheet" href="m-components.css?v=3.0">
    <link rel="stylesheet" href="theme-toggle.css">
    <script src="m-app.js?v=4.3" defer></script>
    <script src="theme-toggle.js" defer></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-gradient-start: #000000;
            --bg-gradient-end: #0a0a0a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #888888;
            --border: rgba(255, 255, 255, 0.1);
            --glass: rgba(255, 255, 255, 0.05);
            --accent-cyan: #00D9FF;
            --accent-red: #FF3D3D;
            --accent-green: #00ff88;
            --glow-cyan: rgba(0, 217, 255, 0.3);
            --glow-red: rgba(255, 61, 61, 0.3);
            --glow-green: rgba(0, 255, 136, 0.3);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header CSS moved to header.css */

        /* Hero Section */
        .ti-hero {
            position: relative;
            padding: 140px 2rem 80px;
            text-align: center;
            overflow: hidden;
            background: linear-gradient(180deg,
                    var(--bg-primary) 0%,
                    var(--bg-secondary) 100%);
            margin-bottom: 0;
        }

        .global-map-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 1;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .ti-hero-content {
            position: relative;
            z-index: 1;
            max-width: 1000px;
            margin: 0 auto;
        }

        .ti-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--accent-green);
            padding: 0.6rem 1.5rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-green);
            box-shadow: 0 0 25px var(--glow-green);
            animation: pulse-glow 2s infinite;
            margin-bottom: 2.5rem;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 25px var(--glow-green);
            }

            50% {
                box-shadow: 0 0 35px var(--glow-green);
            }
        }

        .pulse-dot {
            width: 10px;
            height: 10px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px var(--glow-green);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
                box-shadow: 0 0 10px var(--glow-green);
            }

            50% {
                opacity: 0.7;
                transform: scale(1.3);
                box-shadow: 0 0 20px var(--glow-green);
            }
        }

        .ti-hero h1 {
            font-size: 3.5rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            letter-spacing: -2px;
        }

        .ti-hero h1 span {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .ti-hero p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Main Content */
        .main {
            padding: 0 2rem 4rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Dashboard Controls */
        .dashboard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .last-updated {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .last-updated strong {
            color: var(--text-primary);
        }

        /* Vendor Tabs */
        .vendor-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-cyan) var(--glass);
        }

        .vendor-tabs::-webkit-scrollbar {
            height: 6px;
        }

        .vendor-tabs::-webkit-scrollbar-track {
            background: var(--glass);
            border-radius: 3px;
        }

        .vendor-tabs::-webkit-scrollbar-thumb {
            background: var(--accent-cyan);
            border-radius: 3px;
        }

        .vendor-tab {
            background: var(--glass);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
            position: relative;
        }

        .vendor-tab:hover {
            background: rgba(0, 217, 255, 0.1);
            border-color: var(--accent-cyan);
            color: var(--text-primary);
        }

        .vendor-tab.active {
            background: rgba(0, 217, 255, 0.15);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            box-shadow: 0 0 20px var(--glow-cyan);
        }

        .vendor-tab .tab-count {
            display: inline-block;
            margin-left: 0.5rem;
            padding: 0.15rem 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 0.75rem;
        }

        .vendor-tab.active .tab-count {
            background: var(--accent-cyan);
            color: #000;
        }

        /* Vendor Content */
        .vendor-content {
            display: none;
        }

        .vendor-content.active {
            display: block;
        }

        .vendor-info {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .vendor-info h3 {
            font-size: 1.3rem;
            margin-bottom: 0.75rem;
            color: var(--accent-cyan);
        }

        /* Interactive Stat Cards */
        .interactive-stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 217, 255, 0.2);
        }

        .stat-card-expanded {
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Vendor Tiles Grid */
        .vendor-tiles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .vendor-tile {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .vendor-tile:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 217, 255, 0.2);
            border-color: var(--accent-cyan);
        }

        .vendor-tile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--accent-cyan);
        }

        .vendor-tile-header h3 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent-cyan);
            letter-spacing: 0.5px;
        }

        .vendor-tile-count {
            text-align: center;
            margin: 1.5rem 0;
        }

        .vendor-tile-count span:first-child {
            display: block;
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-cyan);
            line-height: 1;
        }

        .vendor-tile-label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .vendor-tile-type {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
        }

        .vendor-tile-arrow {
            text-align: center;
            color: var(--accent-cyan);
            font-size: 1.2rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .vendor-tiles-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
        }

        @media (max-width: 480px) {
            .vendor-tiles-grid {
                grid-template-columns: 1fr;
            }
        }


        .vendor-info p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .vendor-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .vendor-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .vendor-stat-value {
            display: block;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-cyan);
            margin-bottom: 0.25rem;
        }

        .vendor-stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* IOC Grid */
        .ioc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1rem;
        }

        .ioc-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent-red);
            border-radius: 8px;
            padding: 1.25rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .ioc-card:hover {
            border-left-color: var(--accent-cyan);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        .ioc-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }

        .ioc-type {
            font-weight: 600;
            color: var(--accent-cyan);
            text-transform: uppercase;
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            background: rgba(0, 217, 255, 0.1);
            border-radius: 4px;
        }

        .ioc-source {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .ioc-indicator {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            word-break: break-all;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .ioc-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .ioc-meta {
            display: flex;
            gap: 1rem;
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Daily Analytics */
        .analytics-section {
            margin-top: 3rem;
            padding-top: 3rem;
            border-top: 1px solid var(--border);
        }

        .analytics-section h2 {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: var(--accent-cyan);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .analytics-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .analytics-card h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .analytics-list {
            list-style: none;
        }

        .analytics-list li {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .analytics-list li span:first-child {
            color: var(--text-secondary);
        }

        .analytics-list li span:last-child {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent-cyan);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Footer */
        .footer {
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid var(--border);
            padding: 2rem;
            text-align: center;
            color: var(--text-secondary);
            margin-top: 4rem;
        }

        .footer a {
            color: var(--accent-cyan);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .ti-hero h1 {
                font-size: 2.5rem;
            }

            .dashboard-controls {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .nav {
                display: none;
            }

            .vendor-tabs {
                flex-wrap: nowrap;
            }

            .ioc-grid {
                grid-template-columns: 1fr;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            #ransomwareWidget {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.5rem;
            }

            #ransomwareWidget>div {
                width: 100%;
            }

            #ransomwareWidget button {
                width: 100%;
            }
        }

        /* Light Mode Styles */
        body.light-mode {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-gradient-start: #f8f9fa;
            --bg-gradient-end: #e2e8f0;
            --text-primary: #1a1a1a;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --border: rgba(0, 0, 0, 0.1);
            --accent-cyan: #0066CC;
            --accent-red: #DC2626;
            --accent-green: #059669;
            --glow-cyan: rgba(0, 102, 204, 0.3);
            --glow-red: rgba(220, 38, 38, 0.3);
            --glow-green: rgba(5, 150, 105, 0.3);
        }

        body.light-mode .header {
            background: rgba(255, 255, 255, 0.95);
        }

        /* Seamless fade blend for hero section */
        .ti-hero::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: linear-gradient(to bottom, transparent, var(--bg-primary));
            z-index: 2;
            pointer-events: none;
        }

        body.light-mode .ti-hero {
            background: linear-gradient(135deg, #e0f2fe 0%, #fce7f3 100%);
        }

        /* Fix green badge in light mode */
        body.light-mode .ti-badge {
            background: rgba(5, 150, 105, 0.15);
            border: 1px solid rgba(5, 150, 105, 0.4);
            color: #047857;
            box-shadow: 0 0 20px rgba(5, 150, 105, 0.2);
        }

        body.light-mode .pulse-dot {
            background: #047857;
            box-shadow: 0 0 10px rgba(5, 150, 105, 0.4);
        }

        /* Fix blue gradient text in light mode */
        body.light-mode .ti-hero h1 span {
            background: linear-gradient(135deg, #0066CC, #DC2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.light-mode .main {
            background: #f8f9fa;
        }

        body.light-mode .vendor-tab {
            background: rgba(0, 0, 0, 0.05);
            color: #1a1a1a;
        }

        body.light-mode .vendor-tab.active {
            background: #0066CC;
            color: white;
        }

        body.light-mode .ioc-card {
            background: white;
            border-color: rgba(0, 0, 0, 0.1);
        }

        body.light-mode .analytics-card {
            background: white;
            border-color: rgba(0, 0, 0, 0.1);
        }

        body.light-mode .footer {
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* Loading Spinner for R2 Data Fetching */
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--accent-cyan);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- ========== NEW MOBILE NAVIGATION (v3.0) ========== -->

    <!-- Mobile Header -->
    <header class="m-header m-only">
        <div class="m-header__logo" style="display: flex; align-items: center; gap: 0.75rem;">
            <img src="logo-dark.png" alt="TheHGTech" class="m-logo-img logo-dark"
                style="height: 28px; width: auto; margin: 0;">
            <img src="logo-light.png" alt="TheHGTech" class="m-logo-img logo-light"
                style="height: 28px; width: auto; margin: 0;">
            <span
                style="font-size: 1.2rem; font-weight: 700; background: linear-gradient(135deg, #FF3D3D, #ff8c8c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">TheHGTech</span>
        </div>
        <div class="m-header__actions">
            <!-- Premium Theme Toggle -->
            <button class="m-theme-toggle" onclick="mToggleTheme()" aria-label="Toggle Theme">
                <span class="m-theme-toggle__thumb"></span>
                <span class="m-theme-toggle__stars">
                    <span class="m-theme-toggle__star"></span>
                    <span class="m-theme-toggle__star"></span>
                </span>
            </button>
            <!-- Search Button -->
            <button class="m-header__btn m-header__btn--search" data-action="search" aria-label="Search">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </header>

    <!-- Bottom Navigation (5 items: Home, CVE, TI, Articles, Guides) -->
    <nav class="m-bottom-nav m-only">
        <a href="/" class="m-bottom-nav__item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="/cve-tracker.html" class="m-bottom-nav__item">
            <i class="fas fa-bug"></i>
            <span>CVE</span>
        </a>
        <a href="/threat-intel.html" class="m-bottom-nav__item">
            <i class="fas fa-shield-alt"></i>
            <span>Intel</span>
        </a>
        <a href="/articles.html" class="m-bottom-nav__item">
            <i class="fas fa-newspaper"></i>
            <span>Articles</span>
        </a>
        <a href="/guides/" class="m-bottom-nav__item">
            <i class="fas fa-book"></i>
            <span>Guides</span>
        </a>
    </nav>

    <!-- Search Overlay -->
    <div class="m-search-overlay m-only">
        <div class="m-search-overlay__header">
            <input type="text" class="m-search-overlay__input" placeholder="Search news, CVEs, guides...">
            <button class="m-search-overlay__cancel">Cancel</button>
        </div>
        <div class="m-search-overlay__results"></div>
    </div>

    <!-- Header -->
    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-content">
            <div class="logo">
                <a href="index.html" style="text-decoration: none; display: flex; align-items: center; gap: 0.75rem;">
                    <img src="logo-dark.png" alt="TheHGTech Logo" class="logo-img logo-dark">
                    <img src="logo-light.png" alt="TheHGTech Logo" class="logo-img logo-light">
                    <span class="logo-text">TheHGTech</span>
                </a>
            </div>

            <nav class="nav" role="navigation">
                <a href="index.html#news">News</a>
                <a href="threat-intel.html">Threat Intelligence <span class="live-badge">LIVE</span></a>
                <a href="cve-tracker.html">CVE</a>
                <a href="guides/">Guides</a>
                <a href="comparisons/">Tool Comparisons</a>
                <a href="articles.html">Articles</a>
                <a href="index.html#about">About</a>
                <a href="index.html#contact">Contact</a>

                <div class="theme-toggle-wrapper">
                    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                        <div class="toggle-stars">
                            <div class="star"></div>
                            <div class="star"></div>
                            <div class="star"></div>
                            <div class="star"></div>
                        </div>
                    </button>
                </div>
            </nav>

            <button class="mobile-menu-btn" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <div class="mobile-theme-toggle" id="mobileThemeToggle">
            <i class="fas fa-adjust"></i> Switch Theme
        </div>
        <a href="/index.html#news">News</a>
        <a href="/threat-intel.html">Threat Intelligence</a>
        <a href="/cve-tracker.html">CVE</a>
        <a href="/guides/">Guides</a>
        <a href="/comparisons/">Tool Comparisons</a>
        <a href="/articles.html">Articles</a>
        <a href="/index.html#about">About</a>
        <a href="/index.html#contact">Contact</a>
    </div>

    <!-- SEO Fallback for Search Engines -->
    <noscript>
        <div
            style="max-width: 1200px; margin: 2rem auto; padding: 2rem; background: rgba(255, 255, 255, 0.05); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);">
            <h2 style="color: #00d9ff; margin-bottom: 1rem;">Live Threat Intelligence Dashboard</h2>
            <p style="margin-bottom: 1rem;">This page displays real-time threat intelligence from 9 trusted security
                sources:</p>
            <ul style="margin-left: 2rem; line-height: 1.8;">
                <li>OpenPhish - Phishing URL feed</li>
                <li>URLhaus - Malware distribution URLs</li>
                <li>ThreatFox - Mixed IOCs (URLs, IPs, hashes)</li>
                <li>Feodo Tracker - Botnet C2 IPs</li>
                <li>Blocklist.de - SSH/brute force attackers</li>
                <li>SSL Blacklist - Malicious SSL certificates</li>
            </ul>
            <p style="margin-top: 1rem;"><strong>Note:</strong> This page requires JavaScript to display interactive
                threat intelligence data. For raw data access, visit our <a
                    href="https://github.com/Harish761/thehgtech/blob/main/threat-intel.js"
                    style="color: #00d9ff;">GitHub repository</a>.</p>
            <p style="margin-top: 1rem;">Updated every 4 hours with AI-powered insights and 7-day trend analysis.</p>
        </div>
    </noscript>

    <!-- Hero Section - Premium Design v2 -->
    <section class="ti-hero">
        <!-- Main Hero Content -->
        <div class="hero-content">
            <!-- Live Badge - Inside Content -->
            <div class="threat-level-badge">
                <div class="threat-dot"></div>
                <span class="threat-text">Live</span>
            </div>

            <!-- Title -->
            <h1 class="glitch-title">
                Threat Intelligence<br>
                <span
                    style="background: linear-gradient(135deg, #ff006e 0%, #00d9ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    In Real-Time
                </span>
            </h1>

            <!-- Typing Subtitle -->
            <div class="typing-subtitle">
                <span class="typing-text"></span>
            </div>

            <!-- Description -->
            <p>
                Live indicators of compromise from 9 trusted security vendors, enriched with AI-powered analysis,
                updated every 4 hours. Your command center for staying ahead of emerging threats.
            </p>

            <!-- Live Stats -->
            <div class="live-stats">
                <div class="stat-item">
                    <span class="stat-number" data-target="15000">0</span>
                    <span class="stat-label">Active IOCs</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" data-target="9">0</span>
                    <span class="stat-label">Data Sources</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" data-target="4">0</span>
                    <span class="stat-label">Hour Updates</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Dashboard Controls -->
            <div class="dashboard-controls">
                <div class="last-updated">
                    <strong>Last Updated:</strong> <span id="lastUpdatedTime">Loading...</span>
                </div>
            </div>

            <!-- Automation & Data Policy Disclosure -->
            <div
                style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(102, 126, 234, 0.1)); border-left: 4px solid var(--accent-cyan); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(0, 217, 255, 0.2); margin-bottom: 2rem;">
                <div style="display: flex; align-items: start; gap: 1rem;">
                    <div style="font-size: 20px; color: var(--accent-cyan);">&#9432;</div>
                    <div style="flex: 1;">
                        <h3 style="color: var(--accent-cyan); margin: 0 0 0.75rem 0; font-size: 1.1rem;">Automated Data
                            Collection & Retention Policy</h3>

                        <div style="color: var(--text-muted); font-size: 0.95rem; line-height: 1.6;">
                            <p style="margin: 0 0 0.75rem 0;">
                                <strong>Data Source:</strong> Automatically aggregated from 9 trusted security vendors
                                (OpenPhish, Malware Bazaar, Spamhaus, CINS Army, Blocklist.de, URLhaus, ThreatFox, Feodo
                                Tracker, SSL Blacklist)
                            </p>

                            <p style="margin: 0 0 0.75rem 0;">
                                <strong>Update Frequency:</strong> Every 4 hours via automated collection<br>
                                <strong>Retention Period:</strong> 7 days from first appearance<br>
                                <strong>Auto-Pruning:</strong> IOCs older than 7 days are automatically removed
                            </p>

                            <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">
                                All data is collected automatically without manual intervention. Timestamps indicate
                                when each IOC was first detected, not when it was last updated. This enables meaningful
                                time-based analysis while maintaining data freshness and manageable file sizes.
                            </p>
                        </div>
                    </div>
                </div>


                <!-- Statistics Dashboard -->
                <div class="stats-dashboard"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
                    <div class="stat-card"
                        style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(0, 217, 255, 0.05)); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
                        <div style="text-align: left;">
                            <h3
                                style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;">
                                Total IOCs</h3>
                            <div class="stat-value" id="totalIOCs"
                                style="font-size: 2.5rem; font-weight: 700; color: var(--accent-cyan);">0</div>
                            <div style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem;">Across all
                                sources</div>
                        </div>
                    </div>
                    <div class="stat-card"
                        style="background: linear-gradient(135deg, rgba(255, 76, 76, 0.1), rgba(255, 76, 76, 0.05)); border: 1px solid rgba(255, 76, 76, 0.2); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
                        <div style="text-align: left;">
                            <h3
                                style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;">
                                New (Last Hour)</h3>
                            <div class="stat-value" id="newIOCs"
                                style="font-size: 2.5rem; font-weight: 700; color: var(--accent-red);">0</div>
                            <div style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem;">Recent
                                threats
                            </div>
                        </div>
                    </div>
                    <div class="stat-card"
                        style="background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 255, 136, 0.05)); border: 1px solid rgba(0, 255, 136, 0.2); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
                        <div style="text-align: left;">
                            <h3
                                style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;">
                                Active Campaigns</h3>
                            <div class="stat-value" id="activeCampaigns"
                                style="font-size: 2.5rem; font-weight: 700; color: #00ff88;">0</div>
                            <div style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem;">Ongoing
                                attacks
                            </div>
                        </div>
                    </div>
                    <div class="stat-card"
                        style="background: linear-gradient(135deg, rgba(255, 165, 0, 0.1), rgba(255, 165, 0, 0.05)); border: 1px solid rgba(255, 165, 0, 0.2); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
                        <div style="text-align: left;">
                            <h3
                                style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;">
                                Vendors Active</h3>
                            <div class="stat-value" style="font-size: 2.5rem; font-weight: 700; color: #ffa500;">9/9
                            </div>
                            <div style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem;">All sources
                                online</div>
                        </div>
                    </div>
                </div>


                <!-- Static Snapshot Container (SEO-friendly, loads first) -->

                <!-- Vendor Status Grid -->
                <div style="margin: 2rem 0;">
                    <h3 style="color: var(--text-primary); font-size: 1.1rem; margin-bottom: 1.5rem; font-weight: 600;">
                        üõ°Ô∏è Active Threat Intelligence Sources
                    </h3>
                    <div id="vendorStatusGrid"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
                        <!-- Vendors will be populated here -->
                    </div>
                </div>

                <script>
                    // Populate vendor status grid
                    function populateVendorGrid() {
                        if (!window.threatIntelData || !window.threatIntelData.vendors) {
                            return;
                        }

                        const vendorUrls = {
                            'OpenPhish': 'https://openphish.com/',
                            'Malware Bazaar': 'https://bazaar.abuse.ch/',
                            'Spamhaus DROP': 'https://www.spamhaus.org/drop/',
                            'CINS Army': 'http://cinsscore.com/',
                            'Blocklist.de': 'https://www.blocklist.de/',
                            'URLhaus': 'https://urlhaus.abuse.ch/',
                            'ThreatFox': 'https://threatfox.abuse.ch/',
                            'Feodo Tracker': 'https://feodotracker.abuse.ch/',
                            'SSL Blacklist': 'https://sslbl.abuse.ch/'
                        };

                        const grid = document.getElementById('vendorStatusGrid');
                        if (!grid) return;

                        let html = '';
                        Object.entries(window.threatIntelData.vendors).forEach(([vendor, data]) => {
                            const count = (data.iocCount || 0).toLocaleString();
                            const sourceUrl = vendorUrls[vendor] || '#';

                            html += '<div onclick="openVendorModal(\'' + vendor + '\')" style="background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease; cursor: pointer; position: relative; overflow: hidden; display: flex; flex-direction: column; align-items: center; text-align: center;" ' +
                                'onmouseover="this.style.transform=\'translateY(-4px)\'; this.style.borderColor=\'rgba(0, 217, 255, 0.4)\'; this.style.background=\'rgba(0, 217, 255, 0.05)\'; this.querySelector(\'.vendor-name\').style.color=\'var(--accent-cyan)\';"' +
                                'onmouseout="this.style.transform=\'translateY(0)\'; this.style.borderColor=\'rgba(255, 255, 255, 0.1)\'; this.style.background=\'rgba(255, 255, 255, 0.03)\'; this.querySelector(\'.vendor-name\').style.color=\'var(--text-primary)\';">' +

                                '<div style="position: absolute; top: 0.75rem; right: 0.75rem;">' +
                                '<div style="width: 8px; height: 8px; background: #00ff88; border-radius: 50%; box-shadow: 0 0 10px #00ff88; animation: pulse 2s ease-in-out infinite;"></div>' +
                                '</div>' +

                                '<div class="vendor-name" style="font-size: 1.1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem; transition: color 0.3s ease;">' + vendor + '</div>' +
                                '<div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 1px;">Active Source</div>' +
                                '<div style="font-size: 0.75rem; color: var(--accent-cyan); margin-bottom: 1rem; opacity: 0.9; background: rgba(0, 217, 255, 0.05); padding: 6px 10px; border-radius: 6px; border: 1px solid rgba(0, 217, 255, 0.1);">' +
                                '<div style="margin-bottom: 2px;">Vendor: ' + (data.updateFrequency || 'Unknown') + '</div>' +
                                '<div style="color: var(--text-muted); font-size: 0.7rem;">Sync: Every 4 hours</div>' +
                                '</div>' +

                                '<div style="font-size: 2rem; font-weight: 800; color: var(--accent-cyan); line-height: 1; margin-bottom: 0.5rem;">' + count + '</div>' +
                                '<div style="font-size: 0.8rem; color: var(--text-muted);">IOCs</div>' +

                                '<a href="' + sourceUrl + '" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();" ' +
                                'style="display: inline-block; margin-top: 1rem; font-size: 0.75rem; color: rgba(0, 217, 255, 0.6); text-decoration: none; border-bottom: 1px dotted rgba(0, 217, 255, 0.3); transition: all 0.2s ease;" ' +
                                'onmouseover="this.style.color=\'var(--accent-cyan)\'; this.style.borderBottomColor=\'var(--accent-cyan)\';" onmouseout="this.style.color=\'rgba(0, 217, 255, 0.6)\'; this.style.borderBottomColor=\'rgba(0, 217, 255, 0.3)\';">View Source</a>' +
                                '</div>';
                        });

                        grid.innerHTML = html;
                    }

                    // Call after data loads
                    if (typeof loadThreatData !== 'undefined') {
                        const originalLoadThreatData = loadThreatData;
                        loadThreatData = function () {
                            originalLoadThreatData();
                            setTimeout(populateVendorGrid, 100);
                            setTimeout(populateVendorGrid, 500);
                        };
                    }

                    // Vendor grid population is now handled by consolidated initializeApp()
                </script>

                <style>
                    @keyframes pulse {

                        0%,
                        100% {
                            opacity: 1;
                            transform: scale(1);
                        }

                        50% {
                            opacity: 0.6;
                            transform: scale(1.2);
                        }
                    }
                </style>

                <div id="staticSnapshotContainer" style="margin: 2rem 0;">
                    <!-- This will be populated with static HTML from ti-snapshot.html -->
                    <!-- JavaScript will replace this with interactive content -->
                </div>


                <!-- Daily Analytics -->
                <div class="analytics-section" id="analyticsSection" style="display: none;">
                    <h2>24-Hour Analytics & Trends</h2>

                    <!-- Analytics Metrics Row -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <div
                            style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(0, 217, 255, 0.05)); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 1.5rem;">
                            <h3
                                style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;">
                                Threat Velocity</h3>
                            <div id="threatVelocity"
                                style="font-size: 2.5rem; font-weight: 700; color: var(--accent-cyan);">0</div>
                            <div style="color: var(--text-muted); font-size: 0.85rem; margin-top: 0.25rem;">IOCs/hour
                            </div>
                        </div>

                        <div
                            style="background: linear-gradient(135deg, rgba(48, 209, 88, 0.1), rgba(48, 209, 88, 0.05)); border: 1px solid rgba(48, 209, 88, 0.2); border-radius: 12px; padding: 1.5rem;">
                            <h3
                                style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;">
                                Data Freshness</h3>
                            <div id="dataFreshness" style="font-size: 2.5rem; font-weight: 700; color: #30D158;">0%
                            </div>
                            <div style="color: var(--text-muted); font-size: 0.85rem; margin-top: 0.25rem;">Last 24
                                hours
                            </div>
                        </div>

                        <div
                            style="background: linear-gradient(135deg, rgba(255, 76, 76, 0.1), rgba(255, 76, 76, 0.05)); border: 1px solid rgba(255, 76, 76, 0.2); border-radius: 12px; padding: 1.5rem;">
                            <h3
                                style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;">
                                Critical Threats</h3>
                            <div id="criticalThreats"
                                style="font-size: 2.5rem; font-weight: 700; color: var(--accent-red);">0</div>
                            <div style="color: var(--text-muted); font-size: 0.85rem; margin-top: 0.25rem;">Requires
                                Action
                            </div>
                        </div>
                    </div>

                    <div class="analytics-grid" id="analyticsGrid">
                        <!-- Analytics cards will be loaded dynamically -->
                    </div>

                    <!-- 7-Day Trend Charts -->
                    <h3 style="margin-top: 1rem; margin-bottom: 1.5rem; color: var(--text-primary);">7-Day Trends</h3>

                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                        <div
                            style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 1.5rem;">
                            <h4 style="margin: 0 0 1rem 0; color: var(--accent-cyan);">Total IOCs Trend</h4>
                            <div style="height: 250px;">
                                <canvas id="totalIOCsChart"></canvas>
                            </div>
                        </div>
                        <div
                            style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 1.5rem;">
                            <h4 style="margin: 0 0 1rem 0; color: var(--accent-red);">New IOCs per Day</h4>
                            <div style="height: 250px;">
                                <canvas id="newIOCsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </main>

    <!-- IOC Details Modal -->
    <div id="iocModal"
        style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); overflow: auto;">
        <div
            style="background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end)); margin: 5% auto; padding: 0; border: 1px solid var(--accent-cyan); border-radius: 12px; width: 90%; max-width: 600px; box-shadow: 0 10px 40px rgba(0, 217, 255, 0.3);">
            <div
                style="padding: 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; color: var(--accent-cyan); font-size: 1.3rem;">IOC Details</h2>
                <span onclick="closeModal()"
                    style="color: var(--text-muted); font-size: 2rem; font-weight: bold; cursor: pointer; transition: color 0.3s;">&times;</span>
            </div>
            <div id="modalBody" style="padding: 2rem;"></div>
            <div
                style="padding: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1); display: flex; gap: 1rem; flex-wrap: wrap;">
                <button onclick="copyIOC()"
                    style="flex: 1; min-width: 120px; padding: 0.75rem 1.5rem; background: var(--accent-cyan); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s;">üìã
                    Copy</button>
                <a id="vtLink" target="_blank"
                    style="flex: 1; min-width: 120px; padding: 0.75rem 1.5rem; background: var(--glass); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-weight: 600; text-align: center; text-decoration: none; transition: all 0.3s;">üîç
                    VirusTotal</a>
                <a id="abuseLink" target="_blank"
                    style="flex: 1; min-width: 120px; padding: 0.75rem 1.5rem; background: var(--glass); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-weight: 600; text-align: center; text-decoration: none; transition: all 0.3s;">üö®
                    AbuseIPDB</a>
            </div>
        </div>
    </div>

    <!-- Vendor Modal -->
    <div id="vendorModal" class="modal"
        style="display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px);">
        <div class="modal-content"
            style="background: var(--bg-secondary); margin: 2% auto; padding: 0; border-radius: 16px; max-width: 900px; max-height: 90vh; border: 1px solid var(--border); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); display: flex; flex-direction: column;">
            <!-- Modal Header -->
            <div
                style="padding: 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                <h2 id="vendorModalTitle" style="margin: 0; color: var(--accent-cyan); font-size: 1.5rem;"></h2>
                <button onclick="closeVendorModal()"
                    style="background: none; border: none; color: var(--text-muted); font-size: 2rem; cursor: pointer; padding: 0; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;">&times;</button>
            </div>

            <!-- Search Box -->
            <div style="padding: 1.5rem; border-bottom: 1px solid var(--border);">
                <input type="text" id="vendorModalSearch" placeholder="üîç Search IOCs (indicator, type, description)..."
                    onkeyup="applyVendorFilters()"
                    style="width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 1rem;">
                <div id="vendorModalCount" style="margin-top: 0.75rem; color: var(--text-muted); font-size: 0.9rem;">
                </div>
            </div>

            <!-- Scrollable Content -->
            <div id="vendorModalContent" style="padding: 1.5rem; overflow-y: auto; flex: 1;">
                <p style="color: var(--text-muted);">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="statsModal" class="modal"
        style="display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px);">
        <div class="modal-content"
            style="background: var(--bg-secondary); margin: 2% auto; padding: 0; border-radius: 16px; max-width: 900px; max-height: 90vh; border: 1px solid var(--border); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); display: flex; flex-direction: column;">
            <!-- Modal Header -->
            <div
                style="padding: 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                <h2 id="statsModalTitle" style="margin: 0; color: var(--accent-cyan); font-size: 1.5rem;"></h2>
                <button onclick="closeStatsModal()"
                    style="background: none; border: none; color: var(--text-muted); font-size: 2rem; cursor: pointer; padding: 0; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s ease;">&times;</button>
            </div>

            <!-- Search Box -->
            <div style="padding: 1.5rem; border-bottom: 1px solid var(--border);">
                <input type="text" id="statsModalSearch" placeholder="üîç Start typing to filter..."
                    onkeyup="filterStatsModal()"
                    style="width: 100%; padding: 1rem; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 1rem;">
                <div id="statsModalCount" style="margin-top: 0.75rem; color: var(--text-muted); font-size: 0.9rem;">
                </div>
            </div>

            <!-- Scrollable Content -->
            <div id="statsModalContent" style="padding: 1.5rem; overflow-y: auto; flex: 1;">
                <p style="color: var(--text-muted);">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 TheHGTech. All rights reserved. | <a href="index.html">Home</a> | <a
                href="threat-intel.html">Threat Intelligence</a></p>
        <p style="margin-top: 0.5rem; font-size: 0.9rem;">Live Cyber Threat Intelligence ‚Äî Automated Collection Every 4
            Hours</p>
    </footer>

    <!-- Load threat-intel.js -->
    <script src="threat-intel.js?v=20251124"></script>
    <script src="vendor-modal.js?v=2"></script>
    <script src="threat-analytics.js?v=20251124"></script>

    <script>
        let countdownInterval;
        let autoRefreshInterval;
        let currentVendor = 'overview';

        // ===== CONSOLIDATED INITIALIZATION =====
        // Single DOMContentLoaded listener to prevent race conditions
        let isInitialized = false;

        function initializeApp() {
            if (isInitialized) return;
            isInitialized = true;

            console.log('Initializing Threat Intelligence Dashboard...');

            // 1. Load threat data
            loadThreatData();

            // 2. Initialize search functionality
            const searchInput = document.getElementById('iocSearch');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    currentSearchTerm = e.target.value;
                    applyFilters();
                });
            }

            // 3. Populate vendor grid (with delay to ensure data is loaded)
            setTimeout(() => {
                if (typeof populateVendorGrid === 'function') {
                    populateVendorGrid();
                }
            }, 300);

            console.log('Dashboard initialized successfully');
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            // DOM already loaded
            initializeApp();
        }

        // Load threat intelligence data
        function loadThreatData() {
            if (typeof threatIntelData === 'undefined') {
                document.getElementById('loadingIndicator').innerHTML = '<p style="color: var(--accent-red);">Error: Threat intelligence data not available. Please run fetch_threat_intel.py first.</p>';
                return;
            }

            const data = threatIntelData;

            // Update last updated time - use pre-formatted timestamp to avoid timezone issues
            let lastUpdated = 'Unknown';
            if (data.lastUpdatedFormatted) {
                // Use the pre-formatted timestamp (already in IST)
                lastUpdated = data.lastUpdatedFormatted;
            } else if (data.lastUpdated) {
                // Fallback: parse ISO timestamp but keep it in IST
                try {
                    // The timestamp is already in IST format, just display it
                    const timestamp = data.lastUpdated;
                    const date = timestamp.split('T')[0]; // 2025-11-28
                    const time = timestamp.split('T')[1].split('.')[0]; // 12:06:58

                    const [year, month, day] = date.split('-');
                    const [hour, minute] = time.split(':');

                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    const hour12 = hour % 12 || 12;
                    const ampm = hour >= 12 ? 'PM' : 'AM';

                    lastUpdated = `${monthNames[parseInt(month) - 1]} ${parseInt(day)}, ${year} at ${hour12}:${minute} ${ampm} IST`;
                } catch (e) {
                    lastUpdated = 'Unknown';
                }
            }
            document.getElementById('lastUpdatedTime').textContent = lastUpdated;

            // Hide loading
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }


            // Hide static snapshot (SEO only, replace with interactive)
            const staticSnapshot = document.getElementById('staticSnapshotContainer');
            if (staticSnapshot) {
                staticSnapshot.style.display = 'none';
            }

            // Create vendor tabs - DISABLED: Using new tile design instead
            // createVendorTabs(data);

            // Load overview by default - DISABLED: Using new tile design instead
            // switchVendor('overview');

            // Load analytics
            loadAnalytics(data);

            // Show analytics section and generate comprehensive analytics
            const analyticsSection = document.getElementById('analyticsSection');
            if (analyticsSection) {
                analyticsSection.style.display = 'block';
            }
            if (typeof generateComprehensiveAnalytics === 'function') {
                generateComprehensiveAnalytics();
            }

            // Generate statistics for dashboard
            generateStatistics();

            // Update vendor tile counts
            updateVendorTileCounts();
            // Add delayed retries to ensure counts display after DOM is fully ready
            setTimeout(updateVendorTileCounts, 500);
            setTimeout(updateVendorTileCounts, 1500);
        }

        // Switch vendor tab
        function switchVendor(vendorName) {
            currentVendor = vendorName;

            // Update tab active states
            document.querySelectorAll('.vendor-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event?.target?.classList?.add('active');

            // Load vendor content
            const contentContainer = document.getElementById('vendorContent');

            if (vendorName === 'overview') {
                contentContainer.innerHTML = renderOverview(threatIntelData);
            } else {
                contentContainer.innerHTML = renderVendor(vendorName, threatIntelData.vendors[vendorName]);
            }
        }

        // Render overview
        function renderOverview(data) {
            const overview = data.overview || [];
            const summary = data.dailySummary?.stats || {};

            let html = `
                            < div class="vendor-info" >
                    <h3>Latest Threats Across All Sources</h3>
                    <p>Real-time view of the most recent indicators from all active threat intelligence sources.</p>
                    <div class="vendor-stats">
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${summary.totalIndicators || 0}</span>
                            <span class="vendor-stat-label">Total IOCs</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${summary.activeSources || 0}</span>
                            <span class="vendor-stat-label">Active Sources</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${summary.criticalAlerts || 0}</span>
                            <span class="vendor-stat-label">Critical Alerts</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${summary.activeCampaigns || 0}</span>
                            <span class="vendor-stat-label">Active Campaigns</span>
                        </div>
                    </div>
                </div >
                            <div class="ioc-grid">
                                `;

            overview.slice(0, 20).forEach(ioc => {
                html += renderIOCCard(ioc);
            });

            html += '</div>';
            return html;
        }

        // Render vendor
        function renderVendor(vendorName, vendorData) {
            if (!vendorData) return '<p>No data available for this vendor.</p>';

            const iocs = vendorData.iocs || [];
            const stats = vendorData.stats || {};

            let html = `
                <div class="vendor-info">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                        <div>
                            <h3>${vendorName}</h3>
                            <p>${vendorData.description || ''}</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="exportVendorData('${vendorName}', 'csv')" style="padding: 0.5rem 1rem; background: var(--accent-cyan); border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; font-size: 0.85rem; transition: all 0.3s;">üì• CSV</button>
                            <button onclick="exportVendorData('${vendorName}', 'json')" style="padding: 0.5rem 1rem; background: var(--glass); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-weight: 600; cursor: pointer; font-size: 0.85rem; transition: all 0.3s;">üì• JSON</button>
                        </div>
                    </div>
                    <div class="vendor-stats">
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${stats.total || 0}</span>
                            <span class="vendor-stat-label">Total IOCs</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${stats.newInLastHour || 0}</span>
                            <span class="vendor-stat-label">New (Last Hour)</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${vendorData.updateFrequency || 'Every 2 hours'}</span>
                            <span class="vendor-stat-label">Update Frequency</span>
                        </div>
                    </div>
                </div>
                <div class="ioc-grid">
            `;

            iocs.slice(0, 50).forEach(ioc => {
                html += renderIOCCard(ioc);
            });

            html += '</div>';
            return html;
        }

        // Render IOC card
        function renderIOCCard(ioc) {
            return `
                <div class="ioc-card">
                    <div class="ioc-header">
                        <span class="ioc-type">${ioc.type || 'Unknown'}</span>
                        <span class="ioc-source">${ioc.source || 'Unknown'}</span>
                    </div>
                    <div class="ioc-indicator">${ioc.indicator || 'N/A'}</div>
                    <div class="ioc-description">${ioc.description || 'No description available'}</div>
                    <div class="ioc-meta">
                        <span>Added: ${formatTime(ioc.addedAt)}</span>
                        ${ioc.confidence ? `<span>Confidence: ${ioc.confidence}</span>` : ''}
                    </div>
                </div>
            `;
        }

        // ========================================
        // QUICK WIN FEATURES
        // ========================================

        // Global variables for search/filter
        let currentSearchTerm = '';
        let currentTypeFilter = 'all';
        let currentModalIOC = null;

        // Search/Filter functionality is now initialized in consolidated initializeApp()

        function setFilter(type) {
            currentTypeFilter = type;

            // Update button styles
            document.querySelectorAll('.filter-chip').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = 'var(--glass)';
                btn.style.border = '1px solid var(--border)';
                btn.style.color = 'var(--text-secondary)';
            });

            event.target.classList.add('active');
            event.target.style.background = 'var(--accent-cyan)';
            event.target.style.border = 'none';
            event.target.style.color = 'white';

            applyFilters();
        }

        function applyFilters() {
            const cards = document.querySelectorAll('.ioc-card');
            let visibleCount = 0;

            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                const typeSpan = card.querySelector('.ioc-type');
                const type = typeSpan ? typeSpan.textContent.toLowerCase() : '';

                const matchesSearch = !currentSearchTerm || text.includes(currentSearchTerm.toLowerCase());
                const matchesType = currentTypeFilter === 'all' || type.includes(currentTypeFilter);

                if (matchesSearch && matchesType) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Update search results count
            const resultsDiv = document.getElementById('searchResults');
            if (resultsDiv) {
                resultsDiv.textContent = `Showing ${visibleCount} of ${cards.length} IOCs`;
            }
        }

        // Export functionality
        function exportVendorData(vendor, format) {
            if (!threatIntelData || !threatIntelData.vendors || !threatIntelData.vendors[vendor]) {
                alert('No data available for ' + vendor);
                return;
            }

            const data = threatIntelData.vendors[vendor].iocs;

            if (format === 'csv') {
                const csv = convertToCSV(data);
                downloadFile(csv, `${vendor}_IOCs_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
            } else if (format === 'json') {
                const json = JSON.stringify(data, null, 2);
                downloadFile(json, `${vendor}_IOCs_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            }
        }

        function convertToCSV(iocs) {
            const headers = ['Type', 'Indicator', 'Description', 'Timestamp', 'Source', 'Tags', 'Campaign'];
            const rows = iocs.map(ioc => [
                ioc.type || '',
                ioc.indicator || '',
                (ioc.description || '').replace(/,/g, ';'),
                ioc.timestamp || '',
                ioc.source || '',
                (ioc.tags || []).join(';'),
                (ioc.campaign || '').replace(/,/g, ';')
            ]);

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');

            return csvContent;
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // IOC Details Modal
        function showIOCDetails(ioc) {
            currentModalIOC = ioc;
            const modal = document.getElementById('iocModal');
            const modalBody = document.getElementById('modalBody');

            modalBody.innerHTML = `
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="color: var(--accent-cyan); margin: 0 0 0.5rem 0; font-size: 1.1rem;">Indicator</h3>
                    <div onclick="selectIndicatorText()" style="padding: 1rem; background: rgba(0, 217, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 8px; cursor: text;">
                        <p id="indicatorText" style="margin: 0; color: var(--text-primary); font-family: monospace; font-size: 0.95rem; word-break: break-all; user-select: all; -webkit-user-select: all; -moz-user-select: all; line-height: 1.6;">${ioc.indicator || 'N/A'}</p>
                        <div style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.75rem;">Click to select ‚Ä¢ Use Copy button below</div>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div>
                        <h4 style="color: var(--text-muted); margin: 0 0 0.5rem 0; font-size: 0.9rem;">Type</h4>
                        <p style="margin: 0; color: var(--text-primary);">${ioc.type || 'Unknown'}</p>
                    </div>
                    <div>
                        <h4 style="color: var(--text-muted); margin: 0 0 0.5rem 0; font-size: 0.9rem;">Source</h4>
                        <p style="margin: 0; color: var(--text-primary);">${ioc.source || 'Unknown'}</p>
                    </div>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-muted); margin: 0 0 0.5rem 0; font-size: 0.9rem;">Description</h4>
                    <p style="margin: 0; color: var(--text-primary);">${ioc.description || 'No description available'}</p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                    <div>
                        <h4 style="color: var(--text-muted); margin: 0 0 0.5rem 0; font-size: 0.9rem;">Timestamp</h4>
                        <p style="margin: 0; color: var(--text-primary); font-size: 0.9rem;">${ioc.timestamp || 'Unknown'}</p>
                    </div>
                    <div>
                        <h4 style="color: var(--text-muted); margin: 0 0 0.5rem 0; font-size: 0.9rem;">Campaign</h4>
                        <p style="margin: 0; color: var(--text-primary); font-size: 0.9rem;">${ioc.campaign || 'Unknown'}</p>
                    </div>
                </div>
                <div>
                    <h4 style="color: var(--text-muted); margin: 0 0 0.5rem 0; font-size: 0.9rem;">Tags</h4>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${(ioc.tags || []).map(tag => `<span style="padding: 0.25rem 0.75rem; background: rgba(0, 217, 255, 0.1); border: 1px solid rgba(0, 217, 255, 0.3); border-radius: 4px; color: var(--accent-cyan); font-size: 0.85rem;">${tag}</span>`).join('')}
                    </div>
                </div>
            `;

            // Set external links with full indicator
            const indicator = ioc.indicator || '';
            const iocType = (ioc.type || '').toLowerCase();

            // For URLs, encode properly; for hashes/IPs, use as-is
            if (iocType.includes('url')) {
                // For URLs, use the full URL
                document.getElementById('vtLink').href = `https://www.virustotal.com/gui/url/${btoa(indicator).replace(/=/g, '')}/detection`;
            } else {
                // For hashes, IPs, domains - use search
                document.getElementById('vtLink').href = `https://www.virustotal.com/gui/search/${encodeURIComponent(indicator)}`;
            }

            // AbuseIPDB only works with IPs
            const abuseLink = document.getElementById('abuseLink');
            if (iocType.includes('ip')) {
                abuseLink.href = `https://www.abuseipdb.com/check/${encodeURIComponent(indicator)}`;
                abuseLink.style.display = 'block';
            } else {
                // Hide for non-IPs
                abuseLink.style.display = 'none';
            }


            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('iocModal').style.display = 'none';
            currentModalIOC = null;
        }

        function selectIndicatorText() {
            const textElement = document.getElementById('indicatorText');
            if (textElement) {
                const range = document.createRange();
                range.selectNodeContents(textElement);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }

        function copyIOC() {
            if (currentModalIOC && currentModalIOC.indicator) {
                navigator.clipboard.writeText(currentModalIOC.indicator).then(() => {
                    alert('IOC copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy:', err);
                });
            }
        }

        // Close modal on outside click
        window.onclick = function (event) {
            const modal = document.getElementById('iocModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // ========== STATISTICS MODAL FUNCTIONS ==========

        function toggleStatCard(cardType) {
            // Open modal instead of inline expansion
            openStatsModal(cardType);
        }

        function openStatsModal(cardType) {
            const modal = document.getElementById('statsModal');
            const title = document.getElementById('statsModalTitle');
            const content = document.getElementById('statsModalContent');
            const searchInput = document.getElementById('statsModalSearch');
            const countDiv = document.getElementById('statsModalCount');

            // Clear search
            searchInput.value = '';

            // Set title and populate content based on card type
            if (cardType === 'totalIOCsCard') {
                title.textContent = 'All IOCs (294+)';
                let html = '';
                let totalCount = 0;

                if (threatIntelData && threatIntelData.vendors) {
                    Object.entries(threatIntelData.vendors).forEach(([vendor, data]) => {
                        if (data.iocs && data.iocs.length > 0) {
                            html += `<div style="margin-bottom: 2rem;">`;
                            html += `<h3 style="color: var(--accent-cyan); font-size: 1.1rem; margin-bottom: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;">${vendor} (${data.iocs.length} IOCs)</h3>`;
                            data.iocs.forEach(ioc => {
                                html += `<div class="modal-stat-item" style="padding: 0.75rem; background: rgba(255, 255, 255, 0.02); border-radius: 6px; margin-bottom: 0.5rem; font-size: 0.9rem; word-break: break-all; border-left: 3px solid var(--accent-cyan);">`;
                                html += `<div style="color: var(--text-primary); font-weight: 500;">${ioc.indicator}</div>`;
                                html += `<div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 0.25rem;">Type: ${ioc.type} | Source: ${vendor}</div>`;
                                html += `</div>`;
                                totalCount++;
                            });
                            html += `</div>`;
                        }
                    });
                }
                content.innerHTML = html || '<p style="color: var(--text-muted);">No IOCs available</p>';
                countDiv.textContent = `Showing ${totalCount} IOCs`;

            } else if (cardType === 'newIOCsCard') {
                title.textContent = 'New IOCs (Last Hour)';
                const oneHourAgo = Date.now() - (60 * 60 * 1000);
                let html = '';
                let totalCount = 0;
                if (threatIntelData && threatIntelData.vendors) {
                    Object.entries(threatIntelData.vendors).forEach(([vendor, data]) => {
                        if (data.iocs) {
                            const newIOCs = data.iocs.filter(ioc => {
                                const iocTime = new Date(ioc.first_seen || ioc.timestamp || 0).getTime();
                                return iocTime > oneHourAgo;
                            });

                            if (newIOCs.length > 0) {
                                html += `<div style="margin-bottom: 2rem;">`;
                                html += `<h3 style="color: var(--accent-red); font-size: 1.1rem; margin-bottom: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;">${vendor} (${newIOCs.length} new)</h3>`;
                                newIOCs.forEach(ioc => {
                                    html += `<div class="modal-stat-item" style="padding: 0.75rem; background: rgba(255, 76, 76, 0.05); border-radius: 6px; margin-bottom: 0.5rem; font-size: 0.9rem; word-break: break-all; border-left: 3px solid var(--accent-red);">`;
                                    html += `<div style="color: var(--text-primary); font-weight: 500;">${ioc.indicator}</div>`;
                                    html += `<div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 0.25rem;">Type: ${ioc.type}</div>`;
                                    html += `</div>`;
                                    totalCount++;
                                });
                                html += `</div>`;
                            }
                        }
                    });
                }
                content.innerHTML = html || '<p style="color: var(--text-muted);">No new IOCs in the last hour</p>';
                countDiv.textContent = totalCount > 0 ? `Showing ${totalCount} new IOCs` : 'No new IOCs';

            } else if (cardType === 'campaignsCard') {
                title.textContent = 'Active Campaigns';
                let html = '';
                const campaigns = new Set();

                if (threatIntelData && threatIntelData.vendors) {
                    Object.values(threatIntelData.vendors).forEach(data => {
                        if (data.iocs) {
                            data.iocs.forEach(ioc => {
                                if (ioc.campaign) campaigns.add(ioc.campaign);
                            });
                        }
                    });
                }

                if (campaigns.size > 0) {
                    Array.from(campaigns).forEach(campaign => {
                        html += `<div class="modal-stat-item" style="padding: 1.25rem; background: rgba(0, 255, 136, 0.05); border-radius: 8px; margin-bottom: 1rem; border-left: 3px solid #00ff88;">`;
                        html += `<div style="color: #00ff88; font-weight: 600; font-size: 1.1rem; margin-bottom: 0.5rem;">${campaign}</div>`;
                        html += `<div style="color: var(--text-muted); font-size: 0.9rem;">Active threat campaign</div>`;
                        html += `</div>`;
                    });
                } else {
                    html = '<p style="color: var(--text-muted);">No active campaigns detected</p>';
                }

                content.innerHTML = html;
                countDiv.textContent = `${campaigns.size} active campaigns`;

            } else if (cardType === 'vendorsCard') {
                title.textContent = 'Vendor Status';
                let html = '';
                let activeCount = 0;
                if (threatIntelData && threatIntelData.vendors) {
                    Object.entries(threatIntelData.vendors).forEach(([vendor, data]) => {
                        const iocCount = data.iocs ? data.iocs.length : 0;
                        const status = iocCount > 0 ? 'Active' : 'Inactive';
                        const statusColor = iocCount > 0 ? '#00ff88' : '#ff4c4c';
                        if (iocCount > 0) activeCount++;

                        html += `<div class="modal-stat-item" style="padding: 1.25rem; background: rgba(255, 165, 0, 0.05); border-radius: 8px; margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center; border-left: 3px solid #ffa500;">`;
                        html += `<div>`;
                        html += `<div style="color: #ffa500; font-weight: 600; font-size: 1.1rem;">${vendor}</div>`;
                        html += `<div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.25rem;">${iocCount} IOCs collected</div>`;
                        html += `</div>`;
                        html += `<div style="padding: 0.5rem 1rem; background: ${statusColor}22; border-radius: 6px; color: ${statusColor}; font-size: 0.9rem; font-weight: 600;">${status}</div>`;
                        html += `</div>`;
                    });
                }

                content.innerHTML = html || '<p style="color: var(--text-muted);">No vendors available</p>';
                countDiv.textContent = `${activeCount} active vendors`;
            }

            // Show modal
            modal.style.display = 'block';
        }

        function closeStatsModal() {
            document.getElementById('statsModal').style.display = 'none';
        }

        function filterStatsModal() {
            const searchInput = document.getElementById('statsModalSearch');
            const content = document.getElementById('statsModalContent');
            const countDiv = document.getElementById('statsModalCount');
            const searchTerm = searchInput.value.toLowerCase();

            const items = content.querySelectorAll('.modal-stat-item');
            let visibleCount = 0;
            let totalCount = items.length;

            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });

            if (searchTerm) {
                countDiv.textContent = `Found ${visibleCount} of ${totalCount} items`;
            } else {
                countDiv.textContent = `Showing ${totalCount} items`;
            }
        }

        // Close modal on outside click
        window.onclick = function (event) {
            const modal = document.getElementById('iocModal');
            if (event.target === modal) {
                closeModal();
            }
            const statsModal = document.getElementById('statsModal');
            if (event.target === statsModal) {
                closeStatsModal();
            }
        }

        // ========== DEEP LINKING NAVIGATION FUNCTIONS ==========

        function navigateToIOC(iocIndex) {
            // Get IOC data from global array
            const iocData = window.modalIOCs[iocIndex];
            if (!iocData) return;

            // Close the stats modal
            closeStatsModal();

            // Small delay to let modal close smoothly
            setTimeout(() => {
                // Open the IOC details modal with the data
                openModal(iocData);
            }, 200);
        }

        function navigateToVendor(vendorName) {
            // Close the stats modal
            closeStatsModal();

            // Small delay to let modal close smoothly
            setTimeout(() => {
                // Switch to the vendor tab
                switchTab(vendorName);

                // Scroll to vendor content area
                const vendorContent = document.getElementById('vendorContent');
                if (vendorContent) {
                    vendorContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 200);
        }

        // ========== INTERACTIVE STATISTICS CARDS ==========

        // Statistics Dashboard
        function generateStatistics() {
            if (!window.threatIntelData || !window.threatIntelData.vendors) {
                console.log('No threat data available for statistics');
                return;
            }

            let totalIOCs = 0;
            let newIOCs = 0;
            let activeCampaigns = 0;

            Object.values(window.threatIntelData.vendors).forEach(vendor => {
                // Use stats metadata instead of iocs array
                if (vendor.stats) {
                    totalIOCs += vendor.stats.total || 0;
                    newIOCs += vendor.stats.newInLastHour || 0;
                }
            });

            // Get active campaigns from dailySummary (calculated by Python script)
            if (window.threatIntelData.dailySummary && window.threatIntelData.dailySummary.stats) {
                activeCampaigns = window.threatIntelData.dailySummary.stats.activeCampaigns || 0;
            }

            const totalElement = document.getElementById('totalIOCs');
            const newElement = document.getElementById('newIOCs');
            const campaignsElement = document.getElementById('activeCampaigns');

            console.log('Elements found:', {
                totalElement: !!totalElement,
                newElement: !!newElement,
                campaignsElement: !!campaignsElement
            });

            if (totalElement) {
                totalElement.textContent = totalIOCs.toLocaleString();
                console.log('Updated totalIOCs to:', totalIOCs);
            } else {
                console.error('totalIOCs element not found!');
            }

            if (newElement) {
                newElement.textContent = newIOCs.toLocaleString();
                console.log('Updated newIOCs to:', newIOCs);
            } else {
                console.error('newIOCs element not found!');
            }

            if (campaignsElement) {
                campaignsElement.textContent = activeCampaigns.toLocaleString();
                console.log('Updated activeCampaigns to:', activeCampaigns);
            } else {
                console.error('activeCampaigns element not found!');
            }

            console.log(`Statistics updated: ${totalIOCs} total, ${newIOCs} new, ${activeCampaigns} campaigns`);
        }


        // Update renderIOCCard to add click handler
        const originalRenderIOCCard = renderIOCCard;
        renderIOCCard = function (ioc) {
            const cardHTML = originalRenderIOCCard(ioc);
            // Add onclick to the card
            return cardHTML.replace('<div class="ioc-card">', `<div class="ioc-card" onclick='showIOCDetails(${JSON.stringify(ioc).replace(/'/g, "\\'")})'  style="cursor: pointer;">`);
        }

        // ========================================
        // END QUICK WIN FEATURES
        // ========================================

        // Load analytics
        function loadAnalytics(data) {
            const summary = data.dailySummary;
            if (!summary) return;

            document.getElementById('analyticsSection').style.display = 'block';
            const grid = document.getElementById('analyticsGrid');

            let html = '';

            // Top Threats
            if (summary.topThreats && summary.topThreats.length > 0) {
                html += `
                    <div class="analytics-card">
                        <h3>Top Threats</h3>
                        <ul class="analytics-list">
                            ${summary.topThreats.slice(0, 5).map(threat => `
                                <li>
                                    <span>${threat.name || 'Unknown'}</span>
                                    <span>${threat.count || 0}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            // Targeted Sectors
            if (summary.targetedSectors && summary.targetedSectors.length > 0) {
                html += `
                    <div class="analytics-card">
                        <h3>Targeted Sectors</h3>
                        <ul class="analytics-list">
                            ${summary.targetedSectors.slice(0, 5).map(sector => `
                                <li>
                                    <span>${sector.name || 'Unknown'}</span>
                                    <span>${sector.count || 0}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            // Active Campaigns
            if (summary.campaigns && summary.campaigns.length > 0) {
                html += `
                    <div class="analytics-card">
                        <h3>Active Campaigns</h3>
                        <ul class="analytics-list">
                            ${summary.campaigns.slice(0, 5).map(campaign => `
                                <li>
                                    <span>${campaign.name || 'Unknown'}</span>
                                    <span>${campaign.count || 0}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            grid.innerHTML = html;
        }

        // Format time
        function formatTime(timestamp) {
            if (!timestamp) return 'Unknown';
            try {
                const date = new Date(timestamp);
                const now = new Date();
                const diff = Math.floor((now - date) / 1000 / 60); // minutes

                if (diff < 60) return `${diff}m ago`;
                if (diff < 1440) return `${Math.floor(diff / 60)}h ago`;
                return `${Math.floor(diff / 1440)}d ago`;
            } catch {
                return 'Unknown';
            }
        }

        // ========== 7-DAY TREND VISUALIZATION ==========
        // Load and render historical trend charts
        function loadTrendCharts() {
            // Check if history data is loaded
            if (typeof threatIntelHistory === 'undefined' || !threatIntelHistory.dailySnapshots) {
                console.log('No historical data available for trends');
                return;
            }

            const snapshots = threatIntelHistory.dailySnapshots;
            if (snapshots.length === 0) {
                console.log('No snapshots in history');
                return;
            }

            // Sort by date ascending for charts
            snapshots.sort((a, b) => a.date.localeCompare(b.date));

            // Prepare data
            const dates = snapshots.map(s => {
                const d = new Date(s.date);
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            const totalIOCs = snapshots.map(s => s.metrics.totalIOCs);
            const newIOCs = snapshots.map(s => s.metrics.newIOCs);


            const colors = getThemeColors();

            // Chart.js default config
            Chart.defaults.color = colors.text;
            Chart.defaults.borderColor = colors.grid;
            Chart.defaults.font.family = "'Inter', sans-serif";

            // Total IOCs Trend (Line Chart)
            const totalCtx = document.getElementById('totalIOCsChart');
            if (totalCtx) {
                // Destroy existing chart if it exists to prevent memory leaks/duplicates
                const existingChart = Chart.getChart(totalCtx);
                if (existingChart) existingChart.destroy();

                new Chart(totalCtx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'Total IOCs',
                            data: totalIOCs,
                            borderColor: '#00D9FF',
                            backgroundColor: 'rgba(0, 217, 255, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.tooltipBg,
                                titleColor: '#00D9FF',
                                bodyColor: colors.tooltipText,
                                borderColor: '#00D9FF',
                                borderWidth: 1,
                                titleFont: { weight: 'bold' },
                                padding: 10,
                                displayColors: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: colors.grid },
                                ticks: { color: '#777' }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#777' }
                            }
                        }
                    }
                });
            }

            // New IOCs per Day (Bar Chart)
            const newCtx = document.getElementById('newIOCsChart');
            if (newCtx) {
                // Destroy existing chart if it exists
                const existingChart = Chart.getChart(newCtx);
                if (existingChart) existingChart.destroy();

                new Chart(newCtx, {
                    type: 'bar',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'New IOCs',
                            data: newIOCs,
                            backgroundColor: '#FF4C4C',
                            borderColor: '#FF4C4C',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: colors.tooltipBg,
                                titleColor: '#FF4C4C',
                                bodyColor: colors.tooltipText,
                                borderColor: '#FF4C4C',
                                borderWidth: 1,
                                titleFont: { weight: 'bold' },
                                padding: 10,
                                displayColors: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: colors.grid },
                                ticks: { color: colors.text }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: colors.text }
                            }
                        }
                    }
                });
                console.log(`‚úì Loaded ${snapshots.length}-day trend charts`);
            }
        }

        // Load AI insights
        function loadAIInsights() {
            if (typeof threatIntelHistory === 'undefined' || !threatIntelHistory.aiInsights) {
                console.log('No AI insights available');
                return;
            }

            const insights = threatIntelHistory.aiInsights;
            const container = document.getElementById('analyticsGrid');
            if (!container) return;

            let insightsHTML = '';

            // Daily Summary
            if (insights.dailySummary) {
                const daily = insights.dailySummary;
                insightsHTML += `
                    <div style="background: rgba(0, 217, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin: 0 0 1rem 0; color: var(--accent-cyan);">AI Daily Summary</h4>
                        <p style="margin: 0 0 1rem 0; line-height: 1.6;">${daily.summary}</p>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">Generated: ${new Date(daily.generatedAt).toLocaleString()}</div>
                    </div>
                `;
            }

            // Weekly Analysis
            if (insights.weeklySummary) {
                const weekly = insights.weeklySummary;
                insightsHTML += `
                    <div style="background: rgba(255, 76, 76, 0.05); border: 1px solid rgba(255, 76, 76, 0.2); border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin: 0 0 1rem 0; color: var(--accent-red);">AI Weekly Analysis</h4>
                        ${weekly.trends ? `<p><strong>Trends:</strong> ${weekly.trends.join(', ')}</p>` : ''}
                        ${weekly.anomalies ? `<p><strong>Anomalies:</strong> ${weekly.anomalies.join(', ')}</p>` : ''}
                        ${weekly.recommendations ? `<p><strong>Recommendations:</strong> ${weekly.recommendations.join(', ')}</p>` : ''}
                        ${weekly.summary ? `<p>${weekly.summary}</p>` : ''}
                        <div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 1rem;">Week: ${weekly.weekStart} to ${weekly.weekEnd}</div>
                    </div>
                `;
            }

            if (insightsHTML) {
                container.innerHTML += insightsHTML;
                console.log('‚úì Loaded AI insights');
            }
        }

        // Load AI Insights in Sidebar (Desktop) / Cards (Mobile)
        function loadAIInsightsSidebar() {
            if (typeof threatIntelHistory === 'undefined' || !threatIntelHistory.aiInsights) {
                console.log('No AI insights available for sidebar');
                return;
            }

            const insights = threatIntelHistory.aiInsights;
            const container = document.getElementById('aiInsightsSidebar');
            if (!container) return;

            let insightsHTML = '';

            // Daily Summary
            if (insights.dailySummary) {
                const daily = insights.dailySummary;
                insightsHTML += `
                    <div class="ai-insight-card" style="background: rgba(0, 217, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem;">
                        <h4 style="margin: 0 0 0.75rem 0; color: var(--accent-cyan); font-size: 1rem;">AI Daily Summary</h4>
                        <p style="margin: 0 0 0.75rem 0; line-height: 1.5; font-size: 0.9rem;">${daily.summary}</p>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">Generated: ${new Date(daily.generatedAt).toLocaleDateString()}</div>
                    </div>
                `;
            }

            // Weekly Analysis
            if (insights.weeklySummary) {
                const weekly = insights.weeklySummary;
                insightsHTML += `
                    <div class="ai-insight-card" style="background: rgba(255, 76, 76, 0.05); border: 1px solid rgba(255, 76, 76, 0.2); border-radius: 12px; padding: 1.25rem;">
                        <h4 style="margin: 0 0 0.75rem 0; color: var(--accent-red); font-size: 1rem;">AI Weekly Analysis</h4>
                        ${weekly.trends ? `<p style="font-size: 0.85rem; margin-bottom: 0.5rem;"><strong>Trends:</strong> ${weekly.trends.slice(0, 2).join(', ')}</p>` : ''}
                        ${weekly.recommendations ? `<p style="font-size: 0.85rem; margin: 0;"><strong>Rec:</strong> ${weekly.recommendations[0]}</p>` : ''}
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.75rem;">Week: ${weekly.weekStart} to ${weekly.weekEnd}</div>
                    </div>
                `;
            }

            if (insightsHTML) {
                container.innerHTML = insightsHTML;
                console.log('‚úì Loaded AI insights in sidebar');
            }
        }

        // Dynamic Theme Colors (Global)
        function getThemeColors() {
            const isLight = document.body.classList.contains('light-mode');
            return {
                text: '#777', // Universal gray that works in both light and dark modes
                grid: isLight ? '#ddd' : 'rgba(255, 255, 255, 0.1)',
                tooltipBg: isLight ? 'rgba(255, 255, 255, 0.95)' : 'rgba(0, 0, 0, 0.8)',
                tooltipText: isLight ? '#333' : 'rgba(255, 255, 255, 0.9)',
                tooltipBorder: isLight ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)'
            };
        }

        // Update charts when theme changes
        function updateChartsTheme() {
            const colors = getThemeColors();

            // Update defaults
            Chart.defaults.color = colors.text;
            Chart.defaults.borderColor = colors.grid;

            const updateChart = (chartId) => {
                const chart = Chart.getChart(chartId);
                if (chart) {
                    if (chart.options.scales.y) {
                        chart.options.scales.y.grid.color = colors.grid;
                        chart.options.scales.y.ticks.color = colors.text;
                    }
                    if (chart.options.scales.x) {
                        chart.options.scales.x.ticks.color = colors.text;
                    }
                    if (chart.options.plugins.tooltip) {
                        chart.options.plugins.tooltip.backgroundColor = colors.tooltipBg;
                        chart.options.plugins.tooltip.bodyColor = colors.tooltipText;
                    }
                    chart.update('none');
                }
            };

            updateChart('totalIOCsChart');
            updateChart('newIOCsChart');
        }

        // Listen for theme changes to update charts
        window.addEventListener('themeChanged', function () {
            if (typeof updateChartsTheme === 'function') updateChartsTheme();
            if (window.updateDashboardChartsTheme) window.updateDashboardChartsTheme();
        });

        // Header Functionality
        document.addEventListener('DOMContentLoaded', () => {
            // Theme already initialized above
            if (typeof updateChartsTheme === 'function') updateChartsTheme();

            // Mobile Menu
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const mobileMenu = document.querySelector('.mobile-menu');

            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', () => {
                    mobileMenu.classList.toggle('active');
                    mobileMenuBtn.classList.toggle('active');

                    // Animate hamburger
                    const spans = mobileMenuBtn.querySelectorAll('span');
                    if (mobileMenu.classList.contains('active')) {
                        spans[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
                        spans[1].style.opacity = '0';
                        spans[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
                    } else {
                        spans[0].style.transform = 'none';
                        spans[1].style.opacity = '1';
                        spans[2].style.transform = 'none';
                    }
                });
            }
        });

        // Load Static Snapshot for SEO (loads immediately, replaced by JS later)
        function loadStaticSnapshot() {
            fetch('ti-snapshot.html')
                .then(response => response.text())
                .then(html => {
                    const container = document.getElementById('staticSnapshotContainer');
                    if (container) {
                        container.innerHTML = html;
                        console.log('‚úì Loaded static snapshot for SEO');
                    }
                })
                .catch(error => {
                    console.log('Static snapshot not yet available (will be generated on first run)');
                });
        }

        // Load static snapshot immediately (before other content)
        loadStaticSnapshot();

        // Load everything on page load
        window.addEventListener('load', function () {
            setTimeout(() => {
                loadTrendCharts();
            }, 500);
            loadThemePreference();
        });
    </script>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="threat-intel-history.js?v=20251128"></script>
    <script src="dashboard-data.js?v=20251128"></script>
    <script src="dashboard.js?v=20251127-fix3"></script>
    <script src="threat-intel.js?v=20251127-fix3"></script>
    <script src="threat-intel-tabs.js?v=20251127-fix3"></script>
    <script src="threat-analytics.js?v=20251127-fix3"></script>
    <script src="ransomware-display.js?v=20251127-fix3"></script>
    <!-- Copy to Clipboard Utility -->
    <script src="copy-to-clipboard.js"></script>
</body>

</html>