<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>Live Threat Intelligence with AI Insights & 7-Day Trends | TheHGTech</title>
    <meta name="title" content="Live Threat Intelligence with AI Insights & 7-Day Trends | TheHGTech">
    <meta name="description"
        content="Real-time IOCs from 6 security vendors (OpenPhish, URLhaus, ThreatFox, Feodo, Blocklist.de, SSL Blacklist) with AI-powered daily summaries, weekly analysis, 7-day trend charts, and hourly updates. Free threat intelligence dashboard.">
    <meta name="keywords"
        content="threat intelligence, live IOCs, AI threat analysis, 7-day trends, OpenPhish, URLhaus, ThreatFox, Feodo Tracker, real-time threats, phishing detection, malware feeds, C2 tracking, threat dashboard, security intelligence, GPT-4 analysis">
    <meta name="author" content="TheHGTech">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://thehgtech.com/threat-intel.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thehgtech.com/threat-intel.html">
    <meta property="og:title" content="Live Threat Intelligence with AI Insights & 7-Day Trends | TheHGTech">
    <meta property="og:description"
        content="Real-time IOCs from 6 vendors with AI-powered analysis, 7-day trend charts, and hourly updates. Free threat intelligence dashboard.">
    <meta property="og:image" content="https://thehgtech.com/images/threat-intel-og.jpg">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://thehgtech.com/threat-intel.html">
    <meta name="twitter:title" content="Live Threat Intelligence with AI Insights & 7-Day Trends">
    <meta name="twitter:description"
        content="Real-time IOCs from 6 vendors with AI analysis, 7-day trends, and hourly updates.">
    <meta name="twitter:image" content="https://thehgtech.com/images/threat-intel-twitter.jpg">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-gradient-start: #0D0D0D;
            --bg-gradient-end: #001A33;
            --accent-red: #FF4C4C;
            --accent-cyan: #00D9FF;
            --accent-green: #00ff88;
            --glow-red: rgba(255, 76, 76, 0.5);
            --glow-cyan: rgba(0, 217, 255, 0.5);
            --glow-green: rgba(0, 255, 136, 0.5);
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-muted: #666666;
            --border: rgba(255, 255, 255, 0.1);
            --glass: rgba(255, 255, 255, 0.05);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FF3D3D, #ff8c8c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
            text-decoration: none;
        }

        .nav {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .nav a:hover {
            color: var(--text-primary);
        }

        .nav a.active {
            color: var(--accent-cyan);
        }

        /* Hero Section */
        .ti-hero {
            position: relative;
            padding: 140px 2rem 60px;
            text-align: center;
            overflow: hidden;
        }

        .global-map-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.4;
            z-index: 0;
            pointer-events: none;
        }

        .ti-hero-content {
            position: relative;
            z-index: 1;
            max-width: 1000px;
            margin: 0 auto;
        }

        .ti-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--accent-green);
            padding: 0.6rem 1.5rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-green);
            box-shadow: 0 0 25px var(--glow-green);
            animation: pulse-glow 2s infinite;
            margin-bottom: 2.5rem;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 25px var(--glow-green);
            }

            50% {
                box-shadow: 0 0 35px var(--glow-green);
            }
        }

        .pulse-dot {
            width: 10px;
            height: 10px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px var(--glow-green);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
                box-shadow: 0 0 10px var(--glow-green);
            }

            50% {
                opacity: 0.7;
                transform: scale(1.3);
                box-shadow: 0 0 20px var(--glow-green);
            }
        }

        .ti-hero h1 {
            font-size: 3.5rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            letter-spacing: -2px;
        }

        .ti-hero h1 span {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .ti-hero p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Main Content */
        .main {
            padding: 0 2rem 4rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Dashboard Controls */
        .dashboard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .last-updated {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .last-updated strong {
            color: var(--text-primary);
        }

        .auto-refresh-indicator {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .countdown {
            font-size: 0.9rem;
            color: var(--accent-cyan);
            font-weight: 600;
        }

        .refresh-btn {
            background: linear-gradient(135deg, var(--accent-cyan), #0099cc);
            border: none;
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px var(--glow-cyan);
        }

        /* Vendor Tabs */
        .vendor-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-cyan) var(--glass);
        }

        .vendor-tabs::-webkit-scrollbar {
            height: 6px;
        }

        .vendor-tabs::-webkit-scrollbar-track {
            background: var(--glass);
            border-radius: 3px;
        }

        .vendor-tabs::-webkit-scrollbar-thumb {
            background: var(--accent-cyan);
            border-radius: 3px;
        }

        .vendor-tab {
            background: var(--glass);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
            position: relative;
        }

        .vendor-tab:hover {
            background: rgba(0, 217, 255, 0.1);
            border-color: var(--accent-cyan);
            color: var(--text-primary);
        }

        .vendor-tab.active {
            background: rgba(0, 217, 255, 0.15);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            box-shadow: 0 0 20px var(--glow-cyan);
        }

        .vendor-tab .tab-count {
            display: inline-block;
            margin-left: 0.5rem;
            padding: 0.15rem 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 0.75rem;
        }

        .vendor-tab.active .tab-count {
            background: var(--accent-cyan);
            color: #000;
        }

        /* Vendor Content */
        .vendor-content {
            display: none;
        }

        .vendor-content.active {
            display: block;
        }

        .vendor-info {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
        }

        .vendor-info h3 {
            font-size: 1.3rem;
            margin-bottom: 0.75rem;
            color: var(--accent-cyan);
        }

        .vendor-info p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .vendor-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .vendor-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .vendor-stat-value {
            display: block;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-cyan);
            margin-bottom: 0.25rem;
        }

        .vendor-stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* IOC Grid */
        .ioc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1rem;
        }

        .ioc-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent-red);
            border-radius: 8px;
            padding: 1.25rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .ioc-card:hover {
            border-left-color: var(--accent-cyan);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        .ioc-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }

        .ioc-type {
            font-weight: 600;
            color: var(--accent-cyan);
            text-transform: uppercase;
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            background: rgba(0, 217, 255, 0.1);
            border-radius: 4px;
        }

        .ioc-source {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .ioc-indicator {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            word-break: break-all;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .ioc-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .ioc-meta {
            display: flex;
            gap: 1rem;
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Daily Analytics */
        .analytics-section {
            margin-top: 3rem;
            padding-top: 3rem;
            border-top: 1px solid var(--border);
        }

        .analytics-section h2 {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: var(--accent-cyan);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .analytics-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .analytics-card h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .analytics-list {
            list-style: none;
        }

        .analytics-list li {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .analytics-list li span:first-child {
            color: var(--text-secondary);
        }

        .analytics-list li span:last-child {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent-cyan);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Footer */
        .footer {
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid var(--border);
            padding: 2rem;
            text-align: center;
            color: var(--text-secondary);
            margin-top: 4rem;
        }

        .footer a {
            color: var(--accent-cyan);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .ti-hero h1 {
                font-size: 2.5rem;
            }

            .dashboard-controls {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .nav {
                display: none;
            }

            .vendor-tabs {
                flex-wrap: nowrap;
            }

            .ioc-grid {
                grid-template-columns: 1fr;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Light Mode Styles */
        body.light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --text-muted: #6b7280;
            --border: rgba(0, 0, 0, 0.1);
            --glass: rgba(255, 255, 255, 0.9);
        }

        body.light-mode .header {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.light-mode .ti-hero {
            background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">TheHGTech</a>
            <nav class="nav">
                <a href="index.html">Home</a>
                <a href="threat-intel.html" class="active">Threat Intelligence</a>
                <a href="index.html#news">News</a>
                <a href="index.html#articles">Articles</a>
                <button onclick="toggleTheme()"
                    style="background: none; border: 1px solid var(--border); color: var(--text-primary); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 1.2rem; margin-left: 1rem;"
                    aria-label="Toggle dark or light theme" id="themeToggle">ðŸŒ™</button>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="ti-hero">
        <div class="global-map-bg">
            <svg width="100%" height="100%" viewBox="0 0 1400 700" xmlns="http://www.w3.org/2000/svg"
                preserveAspectRatio="xMidYMid slice">
                <g stroke="#00D9FF" stroke-width="2" fill="none" opacity="0.6">
                    <path
                        d="M 150,180 L 200,160 L 280,170 L 320,200 L 350,240 L 340,280 L 300,310 L 250,300 L 200,280 L 170,240 Z" />
                    <path d="M 500,150 L 580,140 L 650,160 L 680,190 L 670,230 L 630,250 L 580,245 L 520,230 Z" />
                    <path
                        d="M 750,180 L 900,160 L 1050,180 L 1100,220 L 1080,280 L 1000,310 L 900,300 L 800,270 L 750,230 Z" />
                    <path
                        d="M 480,280 L 550,270 L 600,300 L 620,380 L 590,450 L 530,470 L 480,450 L 460,380 L 470,320 Z" />
                    <path
                        d="M 280,350 L 330,340 L 360,380 L 370,450 L 350,520 L 310,540 L 270,520 L 260,450 L 270,390 Z" />
                    <path d="M 950,420 L 1050,410 L 1100,450 L 1080,500 L 1020,520 L 960,510 L 940,470 Z" />

                    <circle cx="250" cy="230" r="5" fill="#FF4C4C" opacity="0.9">
                        <animate attributeName="r" values="5;8;5" dur="2s" repeatCount="indefinite" />
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite" />
                    </circle>
                    <circle cx="600" cy="180" r="5" fill="#FF4C4C" opacity="0.9">
                        <animate attributeName="r" values="5;8;5" dur="2.5s" repeatCount="indefinite" />
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2.5s" repeatCount="indefinite" />
                    </circle>
                    <circle cx="900" cy="240" r="5" fill="#FF4C4C" opacity="0.9">
                        <animate attributeName="r" values="5;8;5" dur="3s" repeatCount="indefinite" />
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="3s" repeatCount="indefinite" />
                    </circle>
                    <circle cx="520" cy="350" r="5" fill="#FF4C4C" opacity="0.9">
                        <animate attributeName="r" values="5;8;5" dur="2.2s" repeatCount="indefinite" />
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2.2s" repeatCount="indefinite" />
                    </circle>
                    <circle cx="1000" cy="460" r="5" fill="#FF4C4C" opacity="0.9">
                        <animate attributeName="r" values="5;8;5" dur="2.8s" repeatCount="indefinite" />
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2.8s" repeatCount="indefinite" />
                    </circle>

                    <line x1="250" y1="230" x2="600" y2="180" stroke="#00D9FF" stroke-width="1" opacity="0.2">
                        <animate attributeName="opacity" values="0.1;0.3;0.1" dur="4s" repeatCount="indefinite" />
                    </line>
                    <line x1="600" y1="180" x2="900" y2="240" stroke="#00D9FF" stroke-width="1" opacity="0.2">
                        <animate attributeName="opacity" values="0.1;0.3;0.1" dur="5s" repeatCount="indefinite" />
                    </line>
                </g>
            </svg>
        </div>

        <div class="ti-hero-content">
            <div class="ti-badge">
                <span class="pulse-dot"></span>
                Updated Hourly
            </div>
            <h1>Live Cyber Threat <span>Intelligence Dashboard</span></h1>
            <p>Multi-vendor intelligence from 6 trusted security sources. Track malicious URLs, IPs, domains, and
                emerging threats in real-time.</p>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Dashboard Controls -->
            <div class="dashboard-controls">
                <div class="last-updated">
                    <strong>Last Updated:</strong> <span id="lastUpdatedTime">Loading...</span>
                </div>
                <div class="auto-refresh-indicator">
                    <span class="countdown">Next refresh in <span id="countdown">60</span>s</span>
                    <button class="refresh-btn" onclick="refreshData()">Refresh Now</button>
                </div>
            </div>

            <!-- AI Insights Section (Prominent Display) -->
            <div id="aiInsightsSidebar"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin: 2rem 0; padding: 1.5rem; background: rgba(255, 255, 255, 0.02); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.05);">
                <!-- AI insights will be loaded here -->
                <div style="text-align: center; color: var(--text-muted); grid-column: 1 / -1;">
                    <p>Loading AI insights...</p>
                </div>
            </div>

            <!-- Vendor Tabs -->
            <div class="vendor-tabs" id="vendorTabs">
                <!-- Tabs will be loaded dynamically -->
            </div>

            <!-- Vendor Content Areas -->
            <div id="vendorContent">
                <div class="loading" id="loadingIndicator">
                    <div class="spinner"></div>
                    <p>Loading threat intelligence data...</p>
                </div>
            </div>

            <!-- Daily Analytics -->
            <div class="analytics-section" id="analyticsSection" style="display: none;">
                <h2>24-Hour Analytics & Trends</h2>
                <div class="analytics-grid" id="analyticsGrid">
                    <!-- Analytics cards will be loaded dynamically -->
                </div>

                <!-- 7-Day Trend Charts -->
                <h3 style="margin-top: 3rem; margin-bottom: 1.5rem; color: var(--text-primary);">7-Day Trends</h3>
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                    <div
                        style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin: 0 0 1rem 0; color: var(--accent-cyan);">Total IOCs Trend</h4>
                        <div style="height: 250px;">
                            <canvas id="totalIOCsChart"></canvas>
                        </div>
                    </div>
                    <div
                        style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin: 0 0 1rem 0; color: var(--accent-red);">New IOCs per Day</h4>
                        <div style="height: 250px;">
                            <canvas id="newIOCsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 TheHGTech. All rights reserved. | <a href="index.html">Home</a> | <a
                href="threat-intel.html">Threat Intelligence</a></p>
        <p style="margin-top: 0.5rem; font-size: 0.9rem;">Live Cyber Threat Intelligence â€” Updated Hourly</p>
    </footer>

    <!-- Load threat-intel.js -->
    <script src="threat-intel.js"></script>

    <script>
        let countdownInterval;
        let autoRefreshInterval;
        let currentVendor = 'overview';

        // Initialize dashboard
        window.addEventListener('DOMContentLoaded', () => {
            loadThreatData();
            startCountdown();
            autoRefreshInterval = setInterval(refreshData, 60000);
        });

        // Load threat intelligence data
        function loadThreatData() {
            if (typeof threatIntelData === 'undefined') {
                document.getElementById('loadingIndicator').innerHTML = '<p style="color: var(--accent-red);">Error: Threat intelligence data not available. Please run fetch_threat_intel.py first.</p>';
                return;
            }

            const data = threatIntelData;

            // Update last updated time - format the ISO timestamp
            let lastUpdated = 'Unknown';
            if (data.lastUpdatedFormatted) {
                lastUpdated = data.lastUpdatedFormatted;
            } else if (data.lastUpdated) {
                try {
                    const date = new Date(data.lastUpdated);
                    lastUpdated = date.toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric',
                        year: 'numeric'
                    }) + ' at ' + date.toLocaleTimeString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: true
                    }) + ' IST';
                } catch (e) {
                    lastUpdated = 'Unknown';
                }
            }
            document.getElementById('lastUpdatedTime').textContent = lastUpdated;

            // Hide loading
            document.getElementById('loadingIndicator').style.display = 'none';

            // Create vendor tabs
            createVendorTabs(data);

            // Load overview by default
            switchVendor('overview');

            // Load analytics
            loadAnalytics(data);
        }

        // Create vendor tabs
        function createVendorTabs(data) {
            const tabsContainer = document.getElementById('vendorTabs');
            const vendors = data.vendors || {};

            let tabsHTML = `
                <button class="vendor-tab active" onclick="switchVendor('overview')">
                    Overview <span class="tab-count">${data.overview?.length || 0}</span>
                </button>
            `;

            Object.keys(vendors).forEach(vendorName => {
                const vendor = vendors[vendorName];
                const count = vendor.stats?.total || 0;
                tabsHTML += `
                    <button class="vendor-tab" onclick="switchVendor('${vendorName}')">
                        ${vendorName} <span class="tab-count">${count}</span>
                    </button>
                `;
            });

            tabsContainer.innerHTML = tabsHTML;
        }

        // Switch vendor tab
        function switchVendor(vendorName) {
            currentVendor = vendorName;

            // Update tab active states
            document.querySelectorAll('.vendor-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event?.target?.classList?.add('active');

            // Load vendor content
            const contentContainer = document.getElementById('vendorContent');

            if (vendorName === 'overview') {
                contentContainer.innerHTML = renderOverview(threatIntelData);
            } else {
                contentContainer.innerHTML = renderVendor(vendorName, threatIntelData.vendors[vendorName]);
            }
        }

        // Render overview
        function renderOverview(data) {
            const overview = data.overview || [];
            const summary = data.dailySummary?.stats || {};

            let html = `
                <div class="vendor-info">
                    <h3>Latest Threats Across All Sources</h3>
                    <p>Real-time view of the most recent indicators from all active threat intelligence sources.</p>
                    <div class="vendor-stats">
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${summary.totalIndicators || 0}</span>
                            <span class="vendor-stat-label">Total IOCs</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${summary.activeSources || 0}</span>
                            <span class="vendor-stat-label">Active Sources</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${summary.criticalAlerts || 0}</span>
                            <span class="vendor-stat-label">Critical Alerts</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${summary.activeCampaigns || 0}</span>
                            <span class="vendor-stat-label">Active Campaigns</span>
                        </div>
                    </div>
                </div>
                <div class="ioc-grid">
            `;

            overview.slice(0, 20).forEach(ioc => {
                html += renderIOCCard(ioc);
            });

            html += '</div>';
            return html;
        }

        // Render vendor
        function renderVendor(vendorName, vendorData) {
            if (!vendorData) return '<p>No data available for this vendor.</p>';

            const iocs = vendorData.iocs || [];
            const stats = vendorData.stats || {};

            let html = `
                <div class="vendor-info">
                    <h3>${vendorName}</h3>
                    <p>${vendorData.description || ''}</p>
                    <div class="vendor-stats">
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${stats.total || 0}</span>
                            <span class="vendor-stat-label">Total IOCs</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${stats.newInLastHour || 0}</span>
                            <span class="vendor-stat-label">New (Last Hour)</span>
                        </div>
                        <div class="vendor-stat">
                            <span class="vendor-stat-value">${vendorData.updateFrequency || 'Hourly'}</span>
                            <span class="vendor-stat-label">Update Frequency</span>
                        </div>
                    </div>
                </div>
                <div class="ioc-grid">
            `;

            iocs.slice(0, 50).forEach(ioc => {
                html += renderIOCCard(ioc);
            });

            html += '</div>';
            return html;
        }

        // Render IOC card
        function renderIOCCard(ioc) {
            return `
                <div class="ioc-card">
                    <div class="ioc-header">
                        <span class="ioc-type">${ioc.type || 'Unknown'}</span>
                        <span class="ioc-source">${ioc.source || 'Unknown'}</span>
                    </div>
                    <div class="ioc-indicator">${ioc.indicator || 'N/A'}</div>
                    <div class="ioc-description">${ioc.description || 'No description available'}</div>
                    <div class="ioc-meta">
                        <span>Added: ${formatTime(ioc.addedAt)}</span>
                        ${ioc.confidence ? `<span>Confidence: ${ioc.confidence}</span>` : ''}
                    </div>
                </div>
            `;
        }

        // Load analytics
        function loadAnalytics(data) {
            const summary = data.dailySummary;
            if (!summary) return;

            document.getElementById('analyticsSection').style.display = 'block';
            const grid = document.getElementById('analyticsGrid');

            let html = '';

            // Top Threats
            if (summary.topThreats && summary.topThreats.length > 0) {
                html += `
                    <div class="analytics-card">
                        <h3>Top Threats</h3>
                        <ul class="analytics-list">
                            ${summary.topThreats.slice(0, 5).map(threat => `
                                <li>
                                    <span>${threat.name || 'Unknown'}</span>
                                    <span>${threat.count || 0}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            // Targeted Sectors
            if (summary.targetedSectors && summary.targetedSectors.length > 0) {
                html += `
                    <div class="analytics-card">
                        <h3>Targeted Sectors</h3>
                        <ul class="analytics-list">
                            ${summary.targetedSectors.slice(0, 5).map(sector => `
                                <li>
                                    <span>${sector.name || 'Unknown'}</span>
                                    <span>${sector.count || 0}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            // Active Campaigns
            if (summary.campaigns && summary.campaigns.length > 0) {
                html += `
                    <div class="analytics-card">
                        <h3>Active Campaigns</h3>
                        <ul class="analytics-list">
                            ${summary.campaigns.slice(0, 5).map(campaign => `
                                <li>
                                    <span>${campaign.name || 'Unknown'}</span>
                                    <span>${campaign.count || 0}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            grid.innerHTML = html;
        }

        // Format time
        function formatTime(timestamp) {
            if (!timestamp) return 'Unknown';
            try {
                const date = new Date(timestamp);
                const now = new Date();
                const diff = Math.floor((now - date) / 1000 / 60); // minutes

                if (diff < 60) return `${diff}m ago`;
                if (diff < 1440) return `${Math.floor(diff / 60)}h ago`;
                return `${Math.floor(diff / 1440)}d ago`;
            } catch {
                return 'Unknown';
            }
        }

        // Auto-refresh countdown
        function startCountdown() {
            let seconds = 60;
            const countdownEl = document.getElementById('countdown');

            countdownInterval = setInterval(() => {
                seconds--;
                countdownEl.textContent = seconds;

                if (seconds <= 0) {
                    refreshData();
                }
            }, 1000);
        }

        // Refresh data
        function refreshData() {
            clearInterval(countdownInterval);
            clearInterval(autoRefreshInterval);
            window.location.reload();
        }

        // ========== 7-DAY TREND VISUALIZATION ==========
        // Load and render historical trend charts
        function loadTrendCharts() {
            // Check if history data is loaded
            if (typeof threatIntelHistory === 'undefined' || !threatIntelHistory.dailySnapshots) {
                console.log('No historical data available for trends');
                return;
            }

            const snapshots = threatIntelHistory.dailySnapshots;
            if (snapshots.length === 0) {
                console.log('No snapshots in history');
                return;
            }

            // Sort by date ascending for charts
            snapshots.sort((a, b) => a.date.localeCompare(b.date));

            // Prepare data
            const dates = snapshots.map(s => {
                const d = new Date(s.date);
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            const totalIOCs = snapshots.map(s => s.metrics.totalIOCs);
            const newIOCs = snapshots.map(s => s.metrics.newIOCs);

            // Chart.js default config
            Chart.defaults.color = '#9CA3AF';
            Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
            Chart.defaults.font.family = "'Inter', sans-serif";

            // Total IOCs Trend (Line Chart)
            const totalCtx = document.getElementById('totalIOCsChart');
            if (totalCtx) {
                new Chart(totalCtx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'Total IOCs',
                            data: totalIOCs,
                            borderColor: '#00D9FF',
                            backgroundColor: 'rgba(0, 217, 255, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#00D9FF',
                                bodyColor: '#fff',
                                borderColor: '#00D9FF',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.05)' } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }

            // New IOCs per Day (Bar Chart)
            const newCtx = document.getElementById('newIOCsChart');
            if (newCtx) {
                new Chart(newCtx, {
                    type: 'bar',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'New IOCs',
                            data: newIOCs,
                            backgroundColor: '#FF4C4C',
                            borderColor: '#FF4C4C',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#FF4C4C',
                                bodyColor: '#fff',
                                borderColor: '#FF4C4C',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.05)' } },
                            x: { grid: { display: false } }
                        }
                    }
                });
                console.log(`âœ“ Loaded ${snapshots.length}-day trend charts`);
            }
        }

        // Load AI insights
        function loadAIInsights() {
            if (typeof threatIntelHistory === 'undefined' || !threatIntelHistory.aiInsights) {
                console.log('No AI insights available');
                return;
            }

            const insights = threatIntelHistory.aiInsights;
            const container = document.getElementById('analyticsGrid');
            if (!container) return;

            let insightsHTML = '';

            // Daily Summary
            if (insights.dailySummary) {
                const daily = insights.dailySummary;
                insightsHTML += `
                    <div style="background: rgba(0, 217, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin: 0 0 1rem 0; color: var(--accent-cyan);">AI Daily Summary</h4>
                        <p style="margin: 0 0 1rem 0; line-height: 1.6;">${daily.summary}</p>
                        <div style="font-size: 0.85rem; color: var(--text-muted);">Generated: ${new Date(daily.generatedAt).toLocaleString()}</div>
                    </div>
                `;
            }

            // Weekly Analysis
            if (insights.weeklySummary) {
                const weekly = insights.weeklySummary;
                insightsHTML += `
                    <div style="background: rgba(255, 76, 76, 0.05); border: 1px solid rgba(255, 76, 76, 0.2); border-radius: 12px; padding: 1.5rem;">
                        <h4 style="margin: 0 0 1rem 0; color: var(--accent-red);">AI Weekly Analysis</h4>
                        ${weekly.trends ? `<p><strong>Trends:</strong> ${weekly.trends.join(', ')}</p>` : ''}
                        ${weekly.anomalies ? `<p><strong>Anomalies:</strong> ${weekly.anomalies.join(', ')}</p>` : ''}
                        ${weekly.recommendations ? `<p><strong>Recommendations:</strong> ${weekly.recommendations.join(', ')}</p>` : ''}
                        ${weekly.summary ? `<p>${weekly.summary}</p>` : ''}
                        <div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 1rem;">Week: ${weekly.weekStart} to ${weekly.weekEnd}</div>
                    </div>
                `;
            }

            if (insightsHTML) {
                container.innerHTML += insightsHTML;
                console.log('âœ“ Loaded AI insights');
            }
        }

        // Load AI Insights in Sidebar (Desktop) / Cards (Mobile)
        function loadAIInsightsSidebar() {
            if (typeof threatIntelHistory === 'undefined' || !threatIntelHistory.aiInsights) {
                console.log('No AI insights available for sidebar');
                return;
            }

            const insights = threatIntelHistory.aiInsights;
            const container = document.getElementById('aiInsightsSidebar');
            if (!container) return;

            let insightsHTML = '';

            // Daily Summary
            if (insights.dailySummary) {
                const daily = insights.dailySummary;
                insightsHTML += `
                    <div class="ai-insight-card" style="background: rgba(0, 217, 255, 0.05); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 12px; padding: 1.25rem; margin-bottom: 1rem;">
                        <h4 style="margin: 0 0 0.75rem 0; color: var(--accent-cyan); font-size: 1rem;">AI Daily Summary</h4>
                        <p style="margin: 0 0 0.75rem 0; line-height: 1.5; font-size: 0.9rem;">${daily.summary}</p>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">Generated: ${new Date(daily.generatedAt).toLocaleDateString()}</div>
                    </div>
                `;
            }

            // Weekly Analysis
            if (insights.weeklySummary) {
                const weekly = insights.weeklySummary;
                insightsHTML += `
                    <div class="ai-insight-card" style="background: rgba(255, 76, 76, 0.05); border: 1px solid rgba(255, 76, 76, 0.2); border-radius: 12px; padding: 1.25rem;">
                        <h4 style="margin: 0 0 0.75rem 0; color: var(--accent-red); font-size: 1rem;">AI Weekly Analysis</h4>
                        ${weekly.trends ? `<p style="font-size: 0.85rem; margin-bottom: 0.5rem;"><strong>Trends:</strong> ${weekly.trends.slice(0, 2).join(', ')}</p>` : ''}
                        ${weekly.recommendations ? `<p style="font-size: 0.85rem; margin: 0;"><strong>Rec:</strong> ${weekly.recommendations[0]}</p>` : ''}
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.75rem;">Week: ${weekly.weekStart} to ${weekly.weekEnd}</div>
                    </div>
                `;
            }

            if (insightsHTML) {
                container.innerHTML = insightsHTML;
                console.log('âœ“ Loaded AI insights in sidebar');
            }
        }

        // Dark/Light Mode Toggle
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLightMode = document.body.classList.contains('light-mode');
            localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
            document.getElementById('themeToggle').textContent = isLightMode ? 'â˜€ï¸' : 'ðŸŒ™';
        }

        function loadThemePreference() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                if (document.getElementById('themeToggle')) {
                    document.getElementById('themeToggle').textContent = 'â˜€ï¸';
                }
            }
        }

        // Load everything on page load
        window.addEventListener('load', function () {
            setTimeout(() => {
                loadTrendCharts();
                loadAIInsights(); // Keep for Analytics tab
                loadAIInsightsSidebar(); // New sidebar version
            }, 500);
            loadThemePreference();
        });
    </script>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Load historical data -->
    <script src="threat-intel-history.js"></script>
</body>

</html>